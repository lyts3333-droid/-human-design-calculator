<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººé¡åœ–è¨ˆç®—å™¨ - Web æ‡‰ç”¨ (Netlify)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .input-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-item {
            display: flex;
            flex-direction: column;
        }

        .form-item label {
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-item input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-item input:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .results-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        @media (max-width: 1024px) {
            .results-section {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: 
                linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%),
                radial-gradient(circle at 20% 50%, rgba(100, 200, 255, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(100, 255, 200, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 20%, rgba(255, 200, 100, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 80%, rgba(255, 100, 200, 0.06) 0%, transparent 50%);
            background-size: 
                100% 100%,
                300px 300px,
                300px 300px,
                300px 300px,
                300px 300px;
            background-position: 
                0% 0%,
                0% 0%,
                100% 100%,
                50% 0%,
                50% 100%;
            background-repeat: no-repeat;
            border-radius: 15px;
            padding: 25px;
            position: relative;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        /* Body Graph å®¹å™¨æ¨£å¼ */
        #body-graph-container {
            width: 100%;
            height: auto;
            min-height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: 
                linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%),
                radial-gradient(circle at 20% 50%, rgba(100, 200, 255, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(100, 255, 200, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 20%, rgba(255, 200, 100, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 80%, rgba(255, 100, 200, 0.06) 0%, transparent 50%);
            background-size: 
                100% 100%,
                300px 300px,
                300px 300px,
                300px 300px,
                300px 300px;
            background-position: 
                0% 0%,
                0% 0%,
                100% 100%,
                50% 0%,
                50% 100%;
            background-repeat: no-repeat;
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }

        #body-graph {
            width: 100%;
            max-width: 600px;
            height: auto;
        }

        /* èƒ½é‡ä¸­å¿ƒæ¨£å¼ */
        .energy-center {
            stroke: #333;
            stroke-width: 2;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .energy-center.defined {
            fill: #4a90e2;
            stroke: #2c5aa0;
            stroke-width: 3;
        }

        .energy-center.undefined {
            fill: #e8e8e8;
            stroke: #999;
            stroke-width: 2;
        }

        .energy-center:hover {
            filter: brightness(1.1);
        }

        /* é€šé“æ¨£å¼ */
        .channel {
            stroke: #ccc;
            stroke-width: 2;
            fill: none;
            transition: all 0.3s ease;
        }

        .channel.defined {
            stroke: #4a90e2;
            stroke-width: 4;
        }

        .channel.undefined {
            stroke: #e0e0e0;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }

        /* ä¸­å¿ƒæ¨™ç±¤ */
        .center-label {
            font-size: 12px;
            font-weight: bold;
            fill: #333;
            pointer-events: none;
            text-anchor: middle;
        }

        .center-label.defined {
            fill: white;
        }

        /* çµæœè¡¨æ ¼æ¨£å¼ */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .results-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 1.1em;
        }

        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .results-table tr:hover {
            background: #f0f0f0;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-defined {
            background: #4a90e2;
            color: white;
        }

        .status-undefined {
            background: #e8e8e8;
            color: #666;
        }

        .type-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            color: white;
            margin: 5px 0;
        }

        .type-generator {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .type-manifestor {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .type-projector {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .type-reflector {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .info-box {
            background: white;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #666;
            line-height: 1.6;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #dc3545;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒŸ äººé¡åœ–è¨ˆç®—å™¨</h1>
            <p>Human Design Calculator - Netlify Function</p>
        </div>

        <div class="content">
            <!-- è¼¸å…¥è¡¨å–®å€åŸŸ -->
            <div class="input-section">
                <h2>è¼¸å…¥å‡ºç”Ÿè³‡æ–™</h2>
                <form id="birth-form">
                    <div class="form-group">
                        <div class="form-item">
                            <label for="year">å¹´ä»½ (Year)</label>
                            <input type="number" id="year" name="year" min="1900" max="2100" 
                                   value="1990" required placeholder="ä¾‹å¦‚ï¼š1990">
                        </div>
                        <div class="form-item">
                            <label for="month">æœˆä»½ (Month)</label>
                            <input type="number" id="month" name="month" min="1" max="12" 
                                   value="5" required placeholder="ä¾‹å¦‚ï¼š5">
                        </div>
                        <div class="form-item">
                            <label for="day">æ—¥æœŸ (Day)</label>
                            <input type="number" id="day" name="day" min="1" max="31" 
                                   value="15" required placeholder="ä¾‹å¦‚ï¼š15">
                        </div>
                        <div class="form-item">
                            <label for="time">æ™‚é–“ (Time)</label>
                            <input type="time" id="time" name="time" 
                                   value="14:30" required>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary" id="calculate-btn">
                            è¨ˆç®—äººé¡åœ–
                        </button>
                        <button type="button" class="btn btn-secondary" id="reset-btn">
                            é‡ç½®
                        </button>
                    </div>
                </form>
                <div id="message-area"></div>
            </div>

            <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
            <div id="results-container" class="hidden">
                <div class="results-section">
                    <!-- å·¦å´ï¼šBody Graph è¦–è¦ºåŒ– -->
                    <div class="section">
                        <h2>èƒ½é‡ä¸­å¿ƒåœ–è¡¨ (Body Graph)</h2>
                        <div id="body-graph-container">
                            <svg id="body-graph" viewBox="0 0 600 800" xmlns="http://www.w3.org/2000/svg">
                                <!-- SVG å…§å®¹èˆ‡ä¹‹å‰çš„ç›¸åŒ -->
                                <defs>
                                    <linearGradient id="definedGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#4a90e2;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#2c5aa0;stop-opacity:1" />
                                    </linearGradient>
                                    <filter id="shadow">
                                        <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
                                    </filter>
                                </defs>

                                <!-- é€šé“ï¼ˆç°¡åŒ–ç‰ˆï¼‰ -->
                                <path id="channel-64-47" class="channel undefined" d="M 275 65 L 250 105" />
                                <path id="channel-61-24" class="channel undefined" d="M 275 65 L 300 105" />
                                <path id="channel-63-4" class="channel undefined" d="M 275 65 L 275 105" />
                                <path id="channel-47-8" class="channel undefined" d="M 250 130 L 220 195" />
                                <path id="channel-24-61" class="channel undefined" d="M 300 130 L 330 195" />
                                <path id="channel-11-56" class="channel undefined" d="M 275 130 L 275 195" />
                                <path id="channel-1-8" class="channel undefined" d="M 200 205 L 160 285" />
                                <path id="channel-10-20" class="channel undefined" d="M 275 215 L 275 285" />
                                <path id="channel-13-33" class="channel undefined" d="M 350 205 L 390 285" />
                                <path id="channel-20-34" class="channel undefined" d="M 275 235 L 275 425" />
                                <path id="channel-12-22" class="channel undefined" d="M 200 205 L 170 495" />
                                <path id="channel-35-36" class="channel undefined" d="M 350 205 L 380 495" />
                                <path id="channel-41-30" class="channel undefined" d="M 350 205 L 420 655" />
                                <path id="channel-21-45" class="channel undefined" d="M 200 205 L 140 395" />
                                <path id="channel-16-48" class="channel undefined" d="M 200 205 L 170 585" />
                                <path id="channel-20-57" class="channel undefined" d="M 275 215 L 220 585" />
                                <path id="channel-2-14" class="channel undefined" d="M 150 290 L 195 425" />
                                <path id="channel-5-15" class="channel undefined" d="M 275 290 L 275 425" />
                                <path id="channel-10-34" class="channel undefined" d="M 400 290 L 355 425" />
                                <path id="channel-37-40" class="channel undefined" d="M 275 290 L 275 495" />
                                <path id="channel-3-60" class="channel undefined" d="M 195 455 L 170 655" />
                                <path id="channel-6-59" class="channel undefined" d="M 275 455 L 275 655" />
                                <path id="channel-9-52" class="channel undefined" d="M 355 455 L 380 655" />
                                <path id="channel-42-53" class="channel undefined" d="M 220 455 L 200 655" />
                                <path id="channel-32-54" class="channel undefined" d="M 330 455 L 350 655" />
                                <path id="channel-39-55" class="channel undefined" d="M 220 455 L 200 505" />
                                <path id="channel-27-50" class="channel undefined" d="M 250 455 L 230 505" />
                                <path id="channel-19-49" class="channel undefined" d="M 300 455 L 320 505" />
                                <path id="channel-29-46" class="channel undefined" d="M 195 455 L 165 585" />
                                <path id="channel-30-41" class="channel undefined" d="M 380 510 L 420 655" />
                                <path id="channel-18-58" class="channel undefined" d="M 150 660 L 140 600" />
                                <path id="channel-28-38" class="channel undefined" d="M 275 660 L 220 600" />
                                <path id="channel-25-51" class="channel undefined" d="M 150 660 L 140 410" />
                                <path id="channel-26-44" class="channel undefined" d="M 140 390 L 165 585" />
                                <path id="channel-7-31" class="channel undefined" d="M 160 390 L 250 285" />

                                <!-- 9 å€‹èƒ½é‡ä¸­å¿ƒ -->
                                <polygon id="center-head" class="energy-center undefined" 
                                    points="200,50 275,50 350,50 300,100 250,100" 
                                    filter="url(#shadow)" />
                                <text class="center-label undefined" x="275" y="75">Head</text>

                                <polygon id="center-ajna" class="energy-center undefined" 
                                    points="250,100 300,100 320,130 300,160 250,160 230,130" 
                                    filter="url(#shadow)" />
                                <text class="center-label undefined" x="275" y="135">Ajna</text>

                                <polygon id="center-throat" class="energy-center undefined" 
                                    points="200,190 240,190 275,210 310,190 350,190 350,220 275,240 200,220" 
                                    filter="url(#shadow)" />
                                <text class="center-label undefined" x="275" y="215">Throat</text>

                                <polygon id="center-g" class="energy-center undefined" 
                                    points="150,280 275,270 400,280 275,300" 
                                    filter="url(#shadow)" />
                                <text class="center-label undefined" x="275" y="285">G</text>

                                <path id="center-ego" class="energy-center undefined" 
                                    d="M 120,400 Q 120,380 140,380 Q 160,380 160,400 Q 160,380 180,380 Q 200,380 200,400 Q 200,430 120,450 Q 120,430 120,400" 
                                    filter="url(#shadow)" />
                                <text class="center-label undefined" x="160" y="415">Ego</text>

                                <ellipse id="center-sacral" class="energy-center undefined" 
                                    cx="275" cy="440" rx="80" ry="30" 
                                    filter="url(#shadow)" />
                                <text class="center-label undefined" x="275" y="445">Sacral</text>

                                <path id="center-solar-plexus" class="energy-center undefined" 
                                    d="M 150,500 Q 150,490 170,490 Q 200,490 250,490 Q 300,490 350,490 Q 400,490 400,500 Q 400,520 350,520 Q 300,520 250,520 Q 200,520 150,520 Q 150,510 150,500" 
                                    filter="url(#shadow)" />
                                <text class="center-label undefined" x="275" y="505">Solar Plexus</text>

                                <polygon id="center-spleen" class="energy-center undefined" 
                                    points="140,580 230,580 185,650" 
                                    filter="url(#shadow)" />
                                <text class="center-label undefined" x="185" y="600">Spleen</text>

                                <rect id="center-root" class="energy-center undefined" 
                                    x="150" y="640" width="250" height="40" rx="5" 
                                    filter="url(#shadow)" />
                                <text class="center-label undefined" x="275" y="662">Root</text>
                            </svg>
                        </div>
                    </div>

                    <!-- å³å´ï¼šåˆ†æçµæœ -->
                    <div class="section">
                        <h2>åˆ†æçµæœ</h2>
                        <div id="text-results-container">
                            <div class="loading">ç­‰å¾…è¨ˆç®—çµæœ...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä¸­å¿ƒåç¨±æ˜ å°„
        const centerNameMap = {
            "Head": "head",
            "Ajna": "ajna",
            "Throat": "throat",
            "G": "g",
            "Ego": "ego",
            "Spleen": "spleen",
            "Sacral": "sacral",
            "Solar_Plexus": "solar-plexus",
            "Root": "root"
        };

        // é€šé“ ID æ˜ å°„å‡½æ•¸
        function getChannelId(gate1, gate2) {
            return `channel-${gate1}-${gate2}`;
        }

        // æ¸²æŸ“äººé¡åœ–çš„ä¸»è¦å‡½å¼
        function renderHumanDesign(data) {
            if (!data || !data.defined_centers_status) {
                console.error("ç„¡æ•ˆçš„æ•¸æ“šæ ¼å¼");
                return;
            }

            // 1. æ›´æ–°èƒ½é‡ä¸­å¿ƒçš„é¡è‰²
            const centers = data.defined_centers_status;
            for (const [centerName, isDefined] of Object.entries(centers)) {
                const centerId = centerNameMap[centerName];
                if (centerId) {
                    const centerElement = document.getElementById(`center-${centerId}`);
                    if (centerElement) {
                        centerElement.classList.remove('defined', 'undefined');
                        centerElement.classList.add(isDefined ? 'defined' : 'undefined');
                        
                        const labelElement = centerElement.nextElementSibling;
                        if (labelElement && labelElement.classList.contains('center-label')) {
                            labelElement.classList.remove('defined', 'undefined');
                            labelElement.classList.add(isDefined ? 'defined' : 'undefined');
                        }
                    }
                }
            }

            // 2. æ›´æ–°é€šé“çš„é¡è‰²ï¼ˆå¦‚æœæœ‰é€šé“æ•¸æ“šï¼‰
            if (data.defined_channels) {
                document.querySelectorAll('.channel').forEach(channel => {
                    channel.classList.remove('defined');
                    channel.classList.add('undefined');
                });

                data.defined_channels.forEach(channel => {
                    const [gate1, gate2] = channel;
                    let channelId = getChannelId(gate1, gate2);
                    let channelElement = document.getElementById(channelId);
                    
                    if (!channelElement) {
                        channelId = getChannelId(gate2, gate1);
                        channelElement = document.getElementById(channelId);
                    }

                    if (channelElement) {
                        channelElement.classList.remove('undefined');
                        channelElement.classList.add('defined');
                    }
                });
            }

            // 3. æ¸²æŸ“æ–‡å­—çµæœ
            renderTextResults(data);
        }

        // æ¸²æŸ“æ–‡å­—çµæœ
        function renderTextResults(data) {
            const container = document.getElementById('text-results-container');
            
            let typeClass = 'type-generator';
            if (data.type && (data.type.includes('é¡¯ç¤ºè€…') || data.type.includes('Manifestor'))) {
                typeClass = 'type-manifestor';
            } else if (data.type && (data.type.includes('æŠ•å°„è€…') || data.type.includes('Projector'))) {
                typeClass = 'type-projector';
            } else if (data.type && (data.type.includes('åæ˜ è€…') || data.type.includes('Reflector'))) {
                typeClass = 'type-reflector';
            }

            let html = `
                <div class="info-box">
                    <h3>è¼¸å…¥æ•¸æ“š</h3>
                    <p><strong>æ—¥æœŸæ™‚é–“ï¼š</strong>${data.input_date || 'N/A'}</p>
                </div>

                <div class="info-box">
                    <h3>äººé¡åœ–é¡å‹ (Type)</h3>
                    <div class="type-badge ${typeClass}">${data.type || 'N/A'}</div>
                </div>

                <div class="info-box">
                    <h3>äººç”Ÿç­–ç•¥ (Strategy)</h3>
                    <p>${data.strategy || 'N/A'}</p>
                </div>

                <div class="info-box">
                    <h3>å…§åœ¨æ¬Šå¨ (Inner Authority)</h3>
                    <p>${data.inner_authority || 'N/A'}</p>
                </div>

                <table class="results-table">
                    <thead>
                        <tr>
                            <th>èƒ½é‡ä¸­å¿ƒ</th>
                            <th>ç‹€æ…‹</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            for (const [centerName, isDefined] of Object.entries(data.defined_centers_status)) {
                const statusClass = isDefined ? 'status-defined' : 'status-undefined';
                const statusText = isDefined ? 'å·²å®šç¾© (Defined)' : 'æœªå®šç¾© (Open)';
                html += `
                    <tr>
                        <td><strong>${centerName}</strong></td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            }

            html += `
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message, type = 'error') {
            const messageArea = document.getElementById('message-area');
            const className = type === 'error' ? 'error-message' : 'success-message';
            messageArea.innerHTML = `<div class="${className}">${message}</div>`;
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }

        // è¡¨å–®æäº¤è™•ç†
        document.getElementById('birth-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const calculateBtn = document.getElementById('calculate-btn');
            const resultsContainer = document.getElementById('results-container');
            const messageArea = document.getElementById('message-area');
            
            // æ”¶é›†è¡¨å–®æ•¸æ“š
            const formData = {
                year: parseInt(document.getElementById('year').value),
                month: parseInt(document.getElementById('month').value),
                day: parseInt(document.getElementById('day').value),
                time: document.getElementById('time').value
            };

            // é©—è­‰æ•¸æ“š
            if (!formData.time || !formData.time.match(/^\d{2}:\d{2}$/)) {
                showMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ™‚é–“æ ¼å¼ (HH:MM)', 'error');
                return;
            }

            // ç¦ç”¨æŒ‰éˆ•ï¼Œé¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            calculateBtn.disabled = true;
            calculateBtn.textContent = 'è¨ˆç®—ä¸­...';
            messageArea.innerHTML = '';

            try {
                // ============================================
                // Netlify Function API èª¿ç”¨
                // ============================================
                const response = await fetch('/.netlify/functions/calculate_hd', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.status === 'success' && result.data) {
                    // é¡¯ç¤ºçµæœå€åŸŸ
                    resultsContainer.classList.remove('hidden');
                    
                    // æ¸²æŸ“è¦–è¦ºåŒ–
                    renderHumanDesign(result.data);
                    
                    showMessage('è¨ˆç®—å®Œæˆï¼', 'success');
                } else {
                    showMessage(result.error || 'è¨ˆç®—å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¼¸å…¥æ•¸æ“š', 'error');
                }
            } catch (error) {
                console.error('éŒ¯èª¤:', error);
                showMessage('ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ã€‚è«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥æˆ–ç¢ºèª Netlify Function æ˜¯å¦æ­£å¸¸é‹è¡Œã€‚', 'error');
            } finally {
                // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                calculateBtn.disabled = false;
                calculateBtn.textContent = 'è¨ˆç®—äººé¡åœ–';
            }
        });

        // é‡ç½®æŒ‰éˆ•
        document.getElementById('reset-btn').addEventListener('click', function() {
            document.getElementById('birth-form').reset();
            document.getElementById('message-area').innerHTML = '';
            document.getElementById('results-container').classList.add('hidden');
        });
    </script>
</body>
</html>

