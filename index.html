<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
    <title>äººé¡åœ–è¨ˆç®—å™¨ - Web æ‡‰ç”¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .input-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-item {
            display: flex;
            flex-direction: column;
        }

        .form-item label {
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-item input,
        .form-item select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            background: white;
        }

        .form-item input:focus,
        .form-item select:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .results-section {
            display: grid;
            grid-template-columns: 1fr 1.6fr;
            gap: 30px;
            margin-top: 30px;
            max-width: 100%; /* ç¢ºä¿å¯ä»¥ä½¿ç”¨å…¨éƒ¨å¯¬åº¦ */
        }

        /* è®“ã€Œè¡Œæ˜Ÿé–˜é–€èˆ‡çˆ»ç·šã€å€å¡Šè·¨è¶Šæ•´å€‹å¯¬åº¦ä¸¦å±…ä¸­ */
        .planet-gates-section {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .planet-gates-section h2 {
            width: 100%;
            text-align: center;
        }

        @media (max-width: 1024px) {
            .results-section {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: 
                linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%),
                radial-gradient(circle at 20% 50%, rgba(100, 200, 255, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(100, 255, 200, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 20%, rgba(255, 200, 100, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 80%, rgba(255, 100, 200, 0.06) 0%, transparent 50%);
            background-size: 
                100% 100%,
                300px 300px,
                300px 300px,
                300px 300px,
                300px 300px;
            background-position: 
                0% 0%,
                0% 0%,
                100% 100%,
                50% 0%,
                50% 100%;
            background-repeat: no-repeat;
            border-radius: 15px;
            padding: 25px 15px; /* æ¸›å°‘å·¦å³ padding */
            position: relative;
        }
        

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.6em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        /* Body Graph å®¹å™¨æ¨£å¼ - ä½¿ç”¨ Grid ä½ˆå±€ï¼ˆåƒ…å·¦å³å…©æ¬„ï¼‰ */
        #body-graph-container {
            width: 100%;
            max-width: 1200px;
            height: auto;
            min-height: 600px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 0 auto !important;
            background: 
                linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%),
                radial-gradient(circle at 20% 50%, rgba(100, 200, 255, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(100, 255, 200, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 20%, rgba(255, 200, 100, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 80%, rgba(255, 100, 200, 0.06) 0%, transparent 50%);
            background-size: 
                100% 100%,
                300px 300px,
                300px 300px,
                300px 300px,
                300px 300px;
            background-position: 
                0% 0%,
                0% 0%,
                100% 100%,
                50% 0%,
                50% 100%;
            background-repeat: no-repeat;
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }

        @media (max-width: 768px) {
            #body-graph-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
            }
        }

        /* å´é‚Šæ¬„æ¨£å¼ */
        .planet-sidebar {
            display: flex;
            flex-direction: column;
            border-radius: 10px;
            padding: 20px;
        }

        .sidebar-design {
            background: #ffe6e6;  /* æ·ºç´…åº•è‰² */
            border: 2px solid #ff9999;
        }

        .sidebar-personality {
            background: #f0f0f0;  /* æ·ºç°åº•è‰² */
            border: 2px solid #cccccc;
        }

        .sidebar-title {
            font-size: 1.6em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 18px;
            padding: 13px;
            border-radius: 8px;
            color: #333;
        }

        .sidebar-design .sidebar-title {
            background: rgba(255, 200, 200, 0.5);
            color: #8b0000;
        }

        .sidebar-personality .sidebar-title {
            background: rgba(200, 200, 200, 0.5);
            color: #333;
        }

        /* è¡Œæ˜Ÿåˆ—è¡¨é … */
        .planet-item {
            display: flex;
            align-items: center;
            padding: 14px 12px;
            margin-bottom: 12px;
            border-radius: 8px;
            transition: background 0.2s;
            font-size: 1.25em;
        }

        .planet-item:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .planet-icon {
            width: 42px;
            height: 42px;
            margin-right: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.6em;
            border-radius: 50%;
            flex-shrink: 0;
            line-height: 1;
        }

        .sidebar-design .planet-icon {
            background: #ffcccc;
            color: #8b0000;
        }

        .sidebar-personality .planet-icon {
            background: #d0d0d0;
            color: #333;
        }

        .planet-name {
            flex: 0 0 90px;
            font-weight: 500;
            font-size: 1.2em;
        }

        .planet-gate-line {
            flex: 0 0 115px;
            text-align: center;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 3px;
        }

        .gate-number {
            font-size: 1.5em;
            font-weight: 700;
            color: #333;
        }
        
        .sidebar-design .gate-number {
            color: #8b0000;  /* æ·±ç´…è‰² */
        }

        .gate-separator {
            font-size: 1.5em;
            color: #999;
        }

        .line-number {
            font-size: 1em;
            color: #666;
            font-weight: 500;
        }
        
        /* æ˜Ÿåº§ç¬¦è™Ÿæ¨£å¼ */
        .zodiac-symbol {
            font-size: 1.4em;
            margin-right: 5px;
            color: #667eea;
            font-weight: bold;
        }
        
        /* å‡é™·ç®­é ­æ¨£å¼ */
        .arrow-ascending {
            color: #28a745;  /* ç¶ è‰² */
            font-size: 1.3em;
            margin-left: 5px;
            font-weight: bold;
            display: inline-block;
        }
        
        .arrow-descending {
            color: #dc3545;  /* ç´…è‰² */
            font-size: 1.3em;
            margin-left: 5px;
            font-weight: bold;
            display: inline-block;
        }

        .planet-sign {
            flex: 1;
            text-align: right;
            font-size: 1.2em;
            color: #666;
        }

        #body-graph {
            width: 100%;
            max-width: 600px;
            height: auto;
        }

        /* èƒ½é‡ä¸­å¿ƒæ¨£å¼ */
        .energy-center {
            stroke: #333;
            stroke-width: 2;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .energy-center.defined {
            fill: #4a90e2;
            stroke: #2c5aa0;
            stroke-width: 3;
        }

        .energy-center.undefined {
            fill: #e8e8e8;
            stroke: #999;
            stroke-width: 2;
        }

        .energy-center:hover {
            filter: brightness(1.1);
        }

        /* é€šé“æ¨£å¼ */
        .channel {
            stroke: #ccc;
            stroke-width: 2;
            fill: none;
            transition: all 0.3s ease;
        }

        .channel.defined {
            stroke: #4a90e2;
            stroke-width: 4;
        }

        .channel.undefined {
            stroke: #e0e0e0;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }

        /* ä¸­å¿ƒæ¨™ç±¤ */
        .center-label {
            font-size: 12px;
            font-weight: bold;
            fill: #333;
            pointer-events: none;
            text-anchor: middle;
        }

        .center-label.defined {
            fill: white;
        }

        /* çµæœè¡¨æ ¼æ¨£å¼ */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .results-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 1.1em;
        }

        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .results-table tr:hover {
            background: #f0f0f0;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-defined {
            background: #4a90e2;
            color: white;
        }

        .status-undefined {
            background: #e8e8e8;
            color: #666;
        }

        .type-badge {
            display: inline-block;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1.4em;
            font-weight: bold;
            color: white;
            margin: 5px 0;
        }

        .type-generator {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .type-manifestor {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .type-projector {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .type-reflector {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .info-box {
            background: white;
            border-left: 4px solid #667eea;
            padding: 18px;
            margin: 18px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .info-box.highlight-box {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        }

        .info-box.warning-box {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.6em;
            font-weight: 600;
        }

        .info-box.highlight-box h3 {
            color: #f59e0b;
        }

        .info-box.warning-box h3 {
            color: #ef4444;
        }

        .info-box p {
            color: #666;
            line-height: 1.8;
            font-size: 1.4em;
            margin: 0;
        }

        .profile-badge {
            display: inline-block;
            font-size: 3em;
            font-weight: bold;
            color: #f59e0b;
            font-family: 'Courier New', monospace;
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            border: 2px solid #f59e0b;
            box-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
        }

        .strategy-text, .authority-text, .definition-text {
            font-weight: 500;
            color: #333;
            font-size: 1.5em;
        }

        .theme-text {
            font-weight: 600;
            color: #ef4444;
            font-size: 1.5em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #dc3545;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }

        .hidden {
            display: none;
        }

        /* æ­·å²è¨˜éŒ„æ¨£å¼ */
        #history-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px 0;
        }

        #history-list .info-box {
            transition: all 0.3s;
        }

        #history-list .info-box:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            #history-list {
                max-height: 300px;
            }

            #history-list .info-box {
                padding: 12px !important;
            }

            #history-list .info-box > div {
                flex-direction: column;
                gap: 10px;
            }

            #history-list .info-box button {
                width: 100%;
            }
        }

        .hidden-field {
            display: none !important;
        }
        
        
        /* åœ“å½¢äººé¡åœ–è¡¨æ¨£å¼ */
        
        /* åŸºå› å¤©å‘½ (Gene Keys) æ¨£å¼ - 5x5 ç¶²æ ¼ç³»çµ± */
        #gene-keys-section {
            margin-top: 40px;
        }
        
        #gene-keys-container {
            position: relative;
            width: 100%;
            min-height: 1200px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 40px;
            overflow: visible;
            display: flex;
            justify-content: center;
            align-items: center;
            /* è§¸æ§æ‰‹å‹¢å„ªåŒ– */
            touch-action: pan-x pan-y pinch-zoom;
        }
        
        /* ç”Ÿå‘½ä¹‹èŠ±èƒŒæ™¯åœ–æ¡ˆ */
        #gene-keys-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(100, 200, 255, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(100, 255, 200, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 50% 20%, rgba(255, 200, 100, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 50% 80%, rgba(255, 100, 200, 0.03) 0%, transparent 50%);
            background-size: 300px 300px, 300px 300px, 300px 300px, 300px 300px;
            background-position: 0% 0%, 100% 100%, 50% 0%, 50% 100%;
            background-repeat: no-repeat;
            opacity: 0.4;
            z-index: 0;
        }
        
        .gene-keys-wrapper {
            position: relative;
            width: 900px;
            height: 900px;
            margin: -20px auto 0 -30px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 100px;
            z-index: 10;
            align-items: center;
            justify-items: center;
            padding: 60px;
        }
        
        .gene-keys-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        
        /* ç¢ºä¿ SVG é€£ç·šåœ¨çƒé«”ä¸‹æ–¹ */
        .gene-keys-svg {
            z-index: 0;
        }
        
        .gene-keys-wrapper {
            z-index: 10;
        }
        
        .gene-keys-svg path {
            fill: none;
        }
        
        .gene-key-sphere {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            grid-template-rows: 1fr 2fr 1fr;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            z-index: 10;
            padding: 5px;
            box-sizing: border-box;
        }
        
        .gene-key-sphere:hover {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
        }
        
        /* å°æ–¼æ²’æœ‰è‡ªå®šç¾© transform çš„çƒé«”ï¼Œhover æ™‚æ‡‰ç”¨ scale */
        .gene-key-sphere:not([data-transform]):hover {
            transform: scale(1.15);
        }
        
        /* å°æ–¼æœ‰è‡ªå®šç¾© transform çš„çƒé«”ï¼Œhover æ™‚åœ¨åŸæœ‰ transform åŸºç¤ä¸ŠåŠ ä¸Š scale */
        .gene-key-sphere[data-transform]:hover {
            transform: var(--original-transform) !important;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3) !important;
        }
        
        .gene-key-sphere.blue {
            /* çç åºåˆ— - å¯¶è—è‰²ç³» */
            background: radial-gradient(circle at 30% 30%, #3498db, #21618c);
            color: white;
        }
        
        .gene-key-sphere.green {
            /* å•Ÿå‹•åºåˆ— - ç¶ è‰²æ”¾å°„ç‹€æ¼¸å±¤ */
            background: radial-gradient(circle at 30% 30%, #76a07b, #2d4d32);
            color: white;
        }
        
        .gene-key-sphere.orange {
            /* é‡‘æ˜Ÿåºåˆ— - æ·±ç´…/é…’ç´…è‰²ç³» */
            background: radial-gradient(circle at 30% 30%, #c0392b, #7b241c);
            color: white;
        }
        
        .gene-key-gate {
            font-size: 2em;
            font-weight: 900;
            line-height: 1;
            text-align: center;
            position: relative;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .gene-key-line {
            position: absolute;
            bottom: 8px;
            right: 12px;
            font-size: 0.75em;
            font-weight: 600;
            color: #cccccc;
            opacity: 0.8;
        }
        
        .gene-key-label {
            font-size: 0.75em;
            text-align: center;
            margin-top: 5px;
            font-weight: 600;
            line-height: 1.2;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .gene-key-desc {
            font-size: 0.65em;
            text-align: center;
            margin-top: 2px;
            opacity: 0.85;
            font-style: italic;
            color: #e0e0e0;
        }
        
        /* åŸºå› å¤©å‘½çƒé«”ä½¿ç”¨èˆ‡åœ“å½¢åœ–è¡¨ç›¸åŒçš„æ–‡å­—æ ¼å¼ */
        .gene-key-sphere .planet-marker-name {
            grid-column: 1 / 4;
            grid-row: 1;
            font-size: 0.7em;
            text-align: center;
            font-weight: 600;
            align-self: center;
        }
        
        .gene-key-sphere .planet-marker-house {
            grid-column: 1;
            grid-row: 2;
            font-size: 0.7em;
            text-align: center;
            align-self: center;
            justify-self: center;
        }
        
        .gene-key-sphere .planet-marker-gate {
            grid-column: 2;
            grid-row: 2;
            font-size: 2.5em;
            font-weight: 900;
            text-align: center;
            align-self: center;
            justify-self: center;
        }
        
        .gene-key-sphere .planet-marker-line {
            grid-column: 3;
            grid-row: 2;
            font-size: 0.7em;
            text-align: center;
            align-self: center;
            justify-self: center;
        }
        
        .gene-key-sphere .planet-marker-zodiac {
            grid-column: 1 / 4;
            grid-row: 3;
            font-size: 0.65em;
            text-align: center;
            align-self: center;
        }
        
        /* ç¢ºä¿æ–‡å­—é¡è‰²æ­£ç¢ºï¼ˆä½¿ç”¨ç™½è‰²æ–‡å­—ï¼‰ */
        .gene-key-sphere .planet-marker-name,
        .gene-key-sphere .planet-marker-gate,
        .gene-key-sphere .planet-marker-line,
        .gene-key-sphere .planet-marker-zodiac {
            color: #ffffff;
        }
        
        .gene-key-sphere.green .planet-marker-name,
        .gene-key-sphere.green .planet-marker-gate,
        .gene-key-sphere.green .planet-marker-line,
        .gene-key-sphere.green .planet-marker-zodiac {
            color: #ffffff;
        }
        
        .gene-key-sphere.blue .planet-marker-name,
        .gene-key-sphere.blue .planet-marker-gate,
        .gene-key-sphere.blue .planet-marker-line,
        .gene-key-sphere.blue .planet-marker-zodiac {
            color: #ffffff;
        }
        
        .gene-key-sphere.orange .planet-marker-name,
        .gene-key-sphere.orange .planet-marker-gate,
        .gene-key-sphere.orange .planet-marker-line,
        .gene-key-sphere.orange .planet-marker-zodiac {
            color: #ffffff;
        }

        /* éæ¿¾æŒ‰éˆ•æ¨£å¼ */
        .filter-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 25px;
            background: white;
            color: #667eea;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        /* éæ¿¾éš±è—æ¨£å¼ */
        .gene-key-sphere.hidden,
        .gene-key-path.hidden {
            display: none !important;
            opacity: 0;
            pointer-events: none;
        }

        .gene-key-sphere.filtered-out {
            opacity: 0.2;
            pointer-events: none;
        }

        .gene-key-path.filtered-out {
            opacity: 0.1;
        }

        /* åŸºå› å¤©å‘½èªªæ˜é¢æ¿æ¨£å¼ */
        .gene-key-detail-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gene-key-detail-panel.hidden {
            display: none;
        }

        .detail-panel-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .detail-panel-container {
            position: relative;
            width: 75%;
            max-width: 900px;
            height: 75vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 10001;
        }

        .detail-panel-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 10002;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .detail-panel-close:hover {
            background: rgba(0, 0, 0, 0.2);
            transform: rotate(90deg);
        }

        .detail-panel-layout {
            display: flex;
            height: 100%;
            overflow: hidden;
        }

        /* å…§å®¹å€ */
        .detail-panel-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: white;
            width: 100%;
        }

        .content-header {
            padding: 30px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        /* æ¨™ç±¤é æŒ‰éˆ• */
        .detail-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 20px 30px;
            border-bottom: 2px solid #f0f0f0;
            background: #f8f9fa;
        }

        .tab-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            border-radius: 25px;
            background: white;
            color: #667eea;
            font-size: 0.95em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-btn:hover {
            background: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .content-badge {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #c0392b 0%, #8b2635 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(192, 57, 43, 0.3);
        }

        .content-header h2 {
            margin: 0;
            font-size: 1.8em;
            color: #333;
        }

        .content-body {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .detail-section {
            margin-bottom: 30px;
            display: none;
        }

        .detail-section.active {
            display: block;
        }

        .detail-section-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .detail-section-content {
            line-height: 1.8;
            color: #555;
            font-size: 1.05em;
        }

        .detail-section-content p {
            margin-bottom: 12px;
        }

        .detail-section-content ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .detail-section-content li {
            margin-bottom: 8px;
        }


        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .detail-panel-container {
                width: 95%;
                height: 90vh;
            }

            .content-header {
                padding: 20px;
                flex-direction: column;
                text-align: center;
            }

            .detail-tabs {
                padding: 15px 20px;
                gap: 8px;
            }

            .tab-btn {
                padding: 8px 15px;
                font-size: 0.85em;
            }

            .content-body {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .filter-buttons {
                gap: 8px;
                margin: 15px 0;
            }

            .filter-btn {
                padding: 8px 16px;
                font-size: 0.9em;
                flex: 1;
                min-width: calc(50% - 4px);
            }
        }

        /* ==================== æ‰‹æ©Ÿç‰ˆ RWD éŸ¿æ‡‰å¼ä½ˆå±€ ==================== */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.6em;
            }

            .header p {
                font-size: 0.95em;
            }

            .content {
                padding: 15px;
            }

            .input-section {
                padding: 15px;
            }

            .input-section h2 {
                font-size: 1.4em;
            }

            /* è¡¨å–®å„ªåŒ–ï¼šåŠ å¤§é»æ“Šå€åŸŸ */
            .form-group {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-item input,
            .form-item select {
                padding: 16px 14px;
                font-size: 16px; /* é˜²æ­¢ iOS ç¸®æ”¾ */
                min-height: 50px;
            }

            .form-item label {
                font-size: 1.05em;
                margin-bottom: 6px;
            }

            /* æŒ‰éˆ•åŠ å¤§ */
            .button-group {
                flex-direction: column;
                gap: 12px;
            }

            .btn {
                padding: 18px 30px;
                font-size: 1.15em;
                width: 100%;
                min-height: 56px;
            }

            /* çµæœå€åŸŸï¼šå‚ç›´å †ç–Š */
            .results-section {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .section {
                padding: 15px;
            }

            .section h2 {
                font-size: 1.3em;
            }

            /* åŸºå› å¤©å‘½å€å¡Šçš„ sectionï¼šå…è¨±æ°´å¹³æ»¾å‹•å’Œç¸®æ”¾ */
            #gene-keys-section {
                padding: 15px 0 !important; /* ç§»é™¤å·¦å³ padding */
                overflow-x: visible !important;
                overflow-y: visible !important;
                width: 100%;
                max-width: 100%;
                touch-action: pan-x pan-y pinch-zoom !important; /* å…è¨±å¹³ç§»å’Œç¸®æ”¾ */
            }
            
            /* ç¢ºä¿å…§å®¹å€åŸŸå¯ä»¥æ»¾å‹• */
            #gene-keys-section .section {
                overflow: visible !important;
                touch-action: pan-x pan-y pinch-zoom !important; /* å…è¨±å¹³ç§»å’Œç¸®æ”¾ */
            }

            /* Body Graph å®¹å™¨ï¼šå‚ç›´å †ç–Š */
            #body-graph-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
                gap: 15px;
                min-height: auto;
                padding: 15px;
            }

            /* å´é‚Šæ¬„æ¨£å¼èª¿æ•´ */
            .planet-sidebar {
                padding: 15px;
            }

            .sidebar-title {
                font-size: 1.3em;
                padding: 10px;
                margin-bottom: 12px;
            }

            .planet-item {
                padding: 10px 8px;
                margin-bottom: 8px;
                font-size: 1em;
            }

            .planet-icon {
                width: 32px;
                height: 32px;
                font-size: 1.3em;
                margin-right: 10px;
            }

            .planet-name {
                flex: 0 0 60px;
                font-size: 0.95em;
            }

            .planet-gate-line {
                flex: 0 0 90px;
            }

            .gate-number {
                font-size: 1.2em;
            }

            .gate-separator {
                font-size: 1.2em;
            }

            .line-number {
                font-size: 0.85em;
            }

            .zodiac-symbol {
                font-size: 1.1em;
            }

            .arrow-ascending,
            .arrow-descending {
                font-size: 1em;
            }

            .planet-sign {
                font-size: 0.9em;
            }

            /* åŸºå› å¤©å‘½å€å¡Šï¼šæ‰‹æ©Ÿç‰ˆå…è¨±æ»¾å‹•å’Œç¸®æ”¾ */
            #gene-keys-container {
                min-height: auto;
                padding: 15px 5px;
                overflow-x: auto !important; /* Android æ»¾å‹•ä¿®æ­£ */
                overflow-y: hidden !important; /* åªå…è¨±æ©«å‘æ»¾å‹• */
                -webkit-overflow-scrolling: touch; /* iOS å¹³æ»‘æ»¾å‹• */
                scrollbar-width: thin; /* Firefox */
                display: block !important; /* ç¢ºä¿å®¹å™¨ä½”æ»¿å¯¬åº¦ä»¥ä¾¿è§¸ç™¼æ²è»¸ */
                touch-action: pan-x pan-y pinch-zoom !important; /* å…è¨±æ©«å‘æ»‘å‹•èˆ‡é›™æŒ‡ç¸®æ”¾ */
                position: relative;
                width: 100%;
                scroll-behavior: smooth;
                will-change: scroll-position;
                scroll-padding: 0;
                -webkit-user-select: none;
                user-select: none;
                -webkit-tap-highlight-color: transparent;
            }

            /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ï¼ˆWebkit ç€è¦½å™¨ï¼‰ */
            #gene-keys-container::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }

            #gene-keys-container::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 10px;
            }

            #gene-keys-container::-webkit-scrollbar-thumb {
                background: #667eea;
                border-radius: 10px;
            }

            #gene-keys-container::-webkit-scrollbar-thumb:hover {
                background: #764ba2;
            }

            .gene-keys-container-wrapper {
                width: 1020px !important; /* 900px å…§å®¹ + å·¦å³å„ 60px padding */
                height: 900px !important;
                margin: 0 !important;
                position: relative;
                touch-action: pan-x pan-y pinch-zoom !important; /* å…è¨±å¹³ç§»å’Œç¸®æ”¾ */
                /* ç¢ºä¿å…§å®¹å®Œæ•´é¡¯ç¤º */
                flex-shrink: 0;
                /* ç¢ºä¿å®¹å™¨åœ¨æ»¾å‹•å®¹å™¨å…§æ­£ç¢ºå®šä½ */
                left: 0;
                top: 0;
                /* å„ªåŒ–æ¸²æŸ“æ€§èƒ½ */
                will-change: transform;
                /* ç¢ºä¿å®¹å™¨ä¸æœƒè¢«å£“ç¸® */
                min-width: 1020px;
                /* ç¢ºä¿å¯ä»¥ç¸®æ”¾ */
                -webkit-user-select: none;
                user-select: none;
            }

            .gene-keys-wrapper {
                width: auto !important;
                min-width: 800px !important; /* å¼·åˆ¶å…§å®¹å¯¬åº¦ï¼Œç¢ºä¿ç”¢ç”Ÿæ²è»¸ */
                height: auto !important;
                min-height: 800px !important;
                margin: 0 auto !important;
                gap: 8px !important;
                padding: 10px 5px !important;
                box-sizing: border-box;
                position: relative;
                flex-shrink: 0;
                touch-action: pan-x pan-y pinch-zoom !important; /* å…è¨±æ©«å‘æ»‘å‹•èˆ‡é›™æŒ‡ç¸®æ”¾ */
                -webkit-user-select: none;
                user-select: none;
            }

            /* æ‰‹æ©Ÿç‰ˆçƒé«”ï¼šä¿æŒèˆ‡æ¡Œé¢ç‰ˆç›¸åŒå°ºå¯¸ */
            .gene-key-sphere {
                width: 120px !important;
                height: 120px !important;
                padding: 5px !important;
                box-sizing: border-box;
                flex-shrink: 0; /* é˜²æ­¢çƒé«”è¢«å£“ç¸® */
                touch-action: pan-x pan-y pinch-zoom !important; /* å…è¨±å¹³ç§»å’Œç¸®æ”¾ */
                -webkit-user-select: none;
                user-select: none;
            }

            /* æ‰‹æ©Ÿç‰ˆå­—é«”ï¼šä¿æŒèˆ‡æ¡Œé¢ç‰ˆç›¸åŒå¤§å° */
            .gene-key-sphere .planet-marker-name {
                font-size: 0.7em !important;
            }

            .gene-key-sphere .planet-marker-gate {
                font-size: 2.5em !important;
            }

            .gene-key-sphere .planet-marker-line {
                font-size: 0.7em !important;
            }

            .gene-key-sphere .planet-marker-zodiac {
                font-size: 0.65em !important;
            }

            /* ç¢ºä¿æ‰‹æ©Ÿç‰ˆä¹Ÿæœ‰ hover æ•ˆæœï¼ˆè§¸æ§è¨­å‚™ï¼‰ */
            .gene-key-sphere[data-transform]:hover,
            .gene-key-sphere[data-transform]:active {
                transform: var(--original-transform) !important;
                box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3) !important;
            }

            /* SVG é€£ç·šï¼šä¿æŒåŸå§‹å°ºå¯¸ï¼Œç¢ºä¿å®Œæ•´é¡¯ç¤º */
            .gene-keys-svg {
                width: 900px !important;
                height: 900px !important;
                left: 60px !important; /* èˆ‡ wrapper å°é½Š */
                position: absolute;
                top: 0;
                /* ç¢ºä¿å¯ä»¥ç¸®æ”¾ */
                touch-action: pan-x pan-y pinch-zoom !important;
                pointer-events: none; /* SVG ä¸æ””æˆªè§¸æ‘¸äº‹ä»¶ï¼Œè®“ç¸®æ”¾æ­£å¸¸å·¥ä½œ */
                /* ç¢ºä¿ SVG èˆ‡ wrapper å®Œå…¨å°é½Š */
                transform: none !important;
            }

            /* Info box èª¿æ•´ */
            .info-box {
                padding: 14px;
                margin: 12px 0;
            }

            .info-box h3 {
                font-size: 1.2em;
            }

            .info-box p {
                font-size: 1.1em;
            }

            .profile-badge {
                font-size: 2em;
                padding: 10px 18px;
            }

            .type-badge {
                font-size: 1.1em;
                padding: 10px 20px;
            }

            .strategy-text,
            .authority-text,
            .definition-text,
            .theme-text {
                font-size: 1.15em;
            }
        }

        /* æ›´å°è¢å¹•ï¼ˆå°æ–¼ 480pxï¼‰çš„é¡å¤–èª¿æ•´ */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.4em;
            }

            /* æ›´å°è¢å¹•ä¹Ÿä¿æŒ 900px å°ºå¯¸ï¼Œå…è¨±æ»¾å‹•å’Œç¸®æ”¾ */
            .gene-keys-container-wrapper {
                width: 900px !important;
                height: 900px !important;
            }

            .gene-keys-wrapper {
                width: 900px !important;
                height: 900px !important;
                margin: -20px auto 0 -30px !important;
                gap: 100px !important;
                padding: 60px !important;
            }

            .gene-key-sphere {
                width: 120px !important;
                height: 120px !important;
                flex-shrink: 0 !important;
            }

            .gene-key-sphere .planet-marker-name {
                font-size: 0.7em !important;
            }

            .gene-key-sphere .planet-marker-gate {
                font-size: 2.5em !important;
            }

            .gene-key-sphere .planet-marker-line {
                font-size: 0.7em !important;
            }

            .gene-key-sphere .planet-marker-zodiac {
                font-size: 0.65em !important;
            }

            .gene-keys-svg {
                width: 900px !important;
                height: 900px !important;
            }

            .planet-name {
                flex: 0 0 50px;
                font-size: 0.85em;
            }

            .planet-gate-line {
                flex: 0 0 75px;
            }

            .planet-icon {
                width: 28px;
                height: 28px;
                font-size: 1.1em;
                margin-right: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒŸ äººé¡åœ–è¨ˆç®—å™¨</h1>
            <p>Human Design Calculator - Web Application</p>
        </div>

        <div class="content">
            <!-- è¼¸å…¥è¡¨å–®å€åŸŸ -->
            <div class="input-section">
                <h2>è¼¸å…¥å‡ºç”Ÿè³‡æ–™</h2>
                <form id="birth-form">
                    <div class="form-group">
                        <div class="form-item">
                            <label for="year">å¹´ä»½ (Year)</label>
                            <input type="number" id="year" name="year" min="1900" max="2100" 
                                   required placeholder="ä¾‹å¦‚ï¼š2002">
                        </div>
                        <div class="form-item">
                            <label for="month">æœˆä»½ (Month)</label>
                            <input type="number" id="month" name="month" min="1" max="12" 
                                   required placeholder="ä¾‹å¦‚ï¼š9">
                        </div>
                        <div class="form-item">
                            <label for="day">æ—¥æœŸ (Day)</label>
                            <input type="number" id="day" name="day" min="1" max="31" 
                                   required placeholder="ä¾‹å¦‚ï¼š21">
                        </div>
                        <div class="form-item">
                            <label for="time">æ™‚é–“ (Time)</label>
                            <input type="time" id="time" name="time" 
                                   required>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-item">
                            <label for="region">åœ°å€ (Region)</label>
                            <select id="region" name="region" required>
                                <option value="">è«‹é¸æ“‡åœ°å€</option>
                                <option value="taiwan">å°ç£</option>
                                <option value="china">ä¸­åœ‹å¤§é™¸</option>
                            </select>
                        </div>
                        <div class="form-item">
                            <label for="county">ç¸£å¸‚/çœä»½ (County/Province)</label>
                            <select id="county" name="county" required>
                                <option value="">è«‹å…ˆé¸æ“‡åœ°å€</option>
                            </select>
                        </div>
                        <div class="form-item">
                            <label for="district">å€åŸŸ/åŸå¸‚ (District/City)</label>
                            <select id="district" name="district" required>
                                <option value="">è«‹å…ˆé¸æ“‡ç¸£å¸‚/çœä»½</option>
                            </select>
                        </div>
                    </div>
                    <!-- éš±è—æ¬„ä½ï¼šä½¿ç”¨ data å±¬æ€§å­˜å„²ï¼Œä¸åƒèˆ‡è¡¨å–®é©—è­‰ -->
                    <input type="hidden" id="timezone" value="Asia/Shanghai">
                    <input type="hidden" id="longitude" value="121.5">
                    <input type="hidden" id="latitude" value="25.0">
                    <div class="button-group">
                        <button type="submit" class="btn btn-primary" id="calculate-btn">
                            è¨ˆç®—äººé¡åœ–
                        </button>
                        <button type="button" class="btn btn-secondary" id="reset-btn">
                            é‡ç½®
                        </button>
                        <button type="button" class="btn btn-secondary" id="history-btn">
                            ğŸ“‹ æ­·å²è¨˜éŒ„
                        </button>
                    </div>
                </form>
                <div id="message-area"></div>
            </div>

            <!-- æ­·å²è¨˜éŒ„å€åŸŸ -->
            <div id="history-container" class="hidden" style="margin-top: 20px;">
                <div class="input-section">
                    <h2>ğŸ“‹ æ­·å²è¨˜éŒ„</h2>
                    <div id="history-list" style="max-height: 400px; overflow-y: auto;">
                        <div class="loading" style="text-align: center; padding: 20px; color: #666;">
                            è¼‰å…¥ä¸­...
                        </div>
                    </div>
                    <div class="button-group" style="margin-top: 15px;">
                        <button type="button" class="btn btn-secondary" id="clear-history-btn">
                            æ¸…ç©ºæ‰€æœ‰è¨˜éŒ„
                        </button>
                        <button type="button" class="btn btn-secondary" id="close-history-btn">
                            é—œé–‰
                        </button>
                    </div>
                </div>
            </div>

            <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
            <div id="results-container" class="hidden">
                <div class="results-section">
                    <!-- è¡Œæ˜Ÿåˆ—è¡¨é¡¯ç¤ºå€åŸŸ -->
                    <div class="section planet-gates-section">
                        <h2>è¡Œæ˜Ÿé–˜é–€èˆ‡çˆ»ç·š</h2>
                        <div id="body-graph-container">
                            <!-- å·¦å´æ¬„ï¼šDesignï¼ˆæ½›æ„è­˜/ç´…è‰²ï¼‰ -->
                            <div class="planet-sidebar sidebar-design" id="design-sidebar">
                                <div class="sidebar-title">æ½›æ„è­˜ (Design)</div>
                                <div id="design-planet-list">
                                    <div class="loading" style="text-align: center; padding: 20px; color: #666;">
                                        ç­‰å¾…æ•¸æ“š...
                                    </div>
                                </div>
                            </div>

                            <!-- å³å´æ¬„ï¼šPersonalityï¼ˆæ„è­˜/ç°è‰²ï¼‰ -->
                            <div class="planet-sidebar sidebar-personality" id="personality-sidebar">
                                <div class="sidebar-title">æ„è­˜ (Personality)</div>
                                <div id="personality-planet-list">
                                    <div class="loading" style="text-align: center; padding: 20px; color: #666;">
                                        ç­‰å¾…æ•¸æ“š...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- åˆ†æçµæœå€å¡Šå·²ç§»é™¤ -->
                </div>
                
                <!-- åŸºå› å¤©å‘½èªªæ˜é¢æ¿ -->
                <div id="gene-key-detail-panel" class="gene-key-detail-panel hidden">
                    <div class="detail-panel-overlay"></div>
                    <div class="detail-panel-container">
                        <button class="detail-panel-close" id="detail-panel-close">Ã—</button>
                        <div class="detail-panel-layout">
                            <!-- å…§å®¹å€ -->
                            <div class="detail-panel-content">
                                <div class="content-header" id="detail-content-header">
                                    <div class="content-badge" id="detail-badge">
                                        <span id="detail-badge-number">1</span>
                                    </div>
                                    <h2 id="detail-title">åŸºå› å¤©å‘½1</h2>
                                </div>
                                <!-- æ¨™ç±¤é æŒ‰éˆ• -->
                                <div class="detail-tabs" id="detail-tabs">
                                    <button class="tab-btn active" data-tab="meaning">æ„ç¾©</button>
                                    <button class="tab-btn" data-tab="shadow">é™°å½±</button>
                                    <button class="tab-btn" data-tab="manifestation">è¡¨ç¾å½¢å¼</button>
                                    <button class="tab-btn" data-tab="gift">å¤©è³¦</button>
                                    <button class="tab-btn" data-tab="transformation">è½‰åŒ–éç¨‹</button>
                                    <button class="tab-btn" data-tab="siddhi">ç¥è–æ‰èƒ½</button>
                                    <button class="tab-btn" data-tab="finalState">æœ€çµ‚ç‹€æ…‹</button>
                                    <button class="tab-btn" data-tab="synthesis">ç¶œåˆæ„ç¾©</button>
                                </div>
                                <div class="content-body" id="detail-content-body">
                                    <!-- å‹•æ…‹ç”Ÿæˆå…§å®¹ -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åŸºå› å¤©å‘½ (Gene Keys) é»ƒé‡‘ä¹‹è·¯å€å¡Š -->
                <div class="section" id="gene-keys-section" style="display: none; margin-top: 30px;">
                    <h2>åŸºå› å¤©å‘½ (Gene Keys) - é»ƒé‡‘ä¹‹è·¯</h2>
                    
                    <!-- éæ¿¾æŒ‰éˆ• -->
                    <div class="filter-buttons" style="display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; justify-content: center;">
                        <button class="filter-btn active" data-filter="all" id="filter-all">
                            ğŸŒŸ å…¨éƒ¨
                        </button>
                        <button class="filter-btn" data-filter="genius" id="filter-genius">
                            ğŸ’š å¤©è³¦
                        </button>
                        <button class="filter-btn" data-filter="love" id="filter-love">
                            â¤ï¸ é—œä¿‚
                        </button>
                        <button class="filter-btn" data-filter="prosperity" id="filter-prosperity">
                            ğŸ’™ æœå‹™
                        </button>
                    </div>
                    
                    <div id="gene-keys-container">
                        <div class="loading">ç­‰å¾…è¨ˆç®—çµæœ...</div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        // ä¸­åœ‹å¤§é™¸çœä»½å’Œä¸»è¦åŸå¸‚æ•¸æ“šï¼ˆåŒ…å«ç¶“ç·¯åº¦ï¼‰
        const chinaLocations = {
            "åŒ—äº¬å¸‚": {
                "æ±åŸå€": { longitude: 116.4164, latitude: 39.9289 },
                "è¥¿åŸå€": { longitude: 116.3654, latitude: 39.9129 },
                "æœé™½å€": { longitude: 116.4434, latitude: 39.9219 },
                "è±å°å€": { longitude: 116.2864, latitude: 39.8589 },
                "çŸ³æ™¯å±±å€": { longitude: 116.2234, latitude: 39.9059 },
                "æµ·æ·€å€": { longitude: 116.2984, latitude: 39.9599 },
                "é–€é ­æºå€": { longitude: 116.1014, latitude: 39.9379 },
                "æˆ¿å±±å€": { longitude: 116.1434, latitude: 39.7479 },
                "é€šå·å€": { longitude: 116.6584, latitude: 39.9099 },
                "é †ç¾©å€": { longitude: 116.6544, latitude: 40.1299 },
                "æ˜Œå¹³å€": { longitude: 116.2304, latitude: 40.2209 },
                "å¤§èˆˆå€": { longitude: 116.3384, latitude: 39.7289 },
                "æ‡·æŸ”å€": { longitude: 116.6374, latitude: 40.3159 },
                "å¹³è°·å€": { longitude: 117.1124, latitude: 40.1449 },
                "å¯†é›²å€": { longitude: 116.8434, latitude: 40.3769 },
                "å»¶æ…¶å€": { longitude: 115.9744, latitude: 40.4569 }
            },
            "ä¸Šæµ·å¸‚": {
                "é»ƒæµ¦å€": { longitude: 121.4844, latitude: 31.2309 },
                "å¾åŒ¯å€": { longitude: 121.4364, latitude: 31.1889 },
                "é•·å¯§å€": { longitude: 121.4224, latitude: 31.2209 },
                "éœå®‰å€": { longitude: 121.4484, latitude: 31.2289 },
                "æ™®é™€å€": { longitude: 121.3924, latitude: 31.2499 },
                "è™¹å£å€": { longitude: 121.5054, latitude: 31.2649 },
                "æ¥Šæµ¦å€": { longitude: 121.5264, latitude: 31.2599 },
                "æµ¦æ±æ–°å€": { longitude: 121.5674, latitude: 31.2459 },
                "é–”è¡Œå€": { longitude: 121.3754, latitude: 31.1129 },
                "å¯¶å±±å€": { longitude: 121.4894, latitude: 31.4059 },
                "å˜‰å®šå€": { longitude: 121.2654, latitude: 31.3749 },
                "é‡‘å±±å€": { longitude: 121.3414, latitude: 30.7419 },
                "æ¾æ±Ÿå€": { longitude: 121.2284, latitude: 31.0329 },
                "é’æµ¦å€": { longitude: 121.1244, latitude: 31.1509 },
                "å¥‰è³¢å€": { longitude: 121.4584, latitude: 30.9179 },
                "å´‡æ˜å€": { longitude: 121.3974, latitude: 31.6229 }
            },
            "å»£æ±çœ": {
                "å»£å·å¸‚": { longitude: 113.2644, latitude: 23.1291 },
                "æ·±åœ³å¸‚": { longitude: 114.0574, latitude: 22.5431 },
                "ç æµ·å¸‚": { longitude: 113.5764, latitude: 22.2709 },
                "æ±•é ­å¸‚": { longitude: 116.6814, latitude: 23.3541 },
                "ä½›å±±å¸‚": { longitude: 113.1214, latitude: 23.0218 },
                "éŸ¶é—œå¸‚": { longitude: 113.5974, latitude: 24.8104 },
                "æ¹›æ±Ÿå¸‚": { longitude: 110.3644, latitude: 21.2707 },
                "è‚‡æ…¶å¸‚": { longitude: 112.4724, latitude: 23.0515 },
                "æ±Ÿé–€å¸‚": { longitude: 113.0814, latitude: 22.5787 },
                "èŒ‚åå¸‚": { longitude: 110.9244, latitude: 21.6597 },
                "æƒ å·å¸‚": { longitude: 114.4154, latitude: 23.1107 },
                "æ¢…å·å¸‚": { longitude: 116.1174, latitude: 24.2884 },
                "æ±•å°¾å¸‚": { longitude: 115.3754, latitude: 22.7864 },
                "æ²³æºå¸‚": { longitude: 114.6974, latitude: 23.7462 },
                "é™½æ±Ÿå¸‚": { longitude: 111.9774, latitude: 21.8573 },
                "æ¸…é å¸‚": { longitude: 113.0514, latitude: 23.6850 },
                "æ±èå¸‚": { longitude: 113.7514, latitude: 23.0205 },
                "ä¸­å±±å¸‚": { longitude: 113.3924, latitude: 22.5169 },
                "æ½®å·å¸‚": { longitude: 116.6224, latitude: 23.6569 },
                "æ­é™½å¸‚": { longitude: 116.3724, latitude: 23.5497 },
                "é›²æµ®å¸‚": { longitude: 112.0444, latitude: 22.9297 }
            },
            "æ±Ÿè˜‡çœ": {
                "å—äº¬å¸‚": { longitude: 118.7964, latitude: 32.0603 },
                "ç„¡éŒ«å¸‚": { longitude: 120.3114, latitude: 31.4911 },
                "å¾å·å¸‚": { longitude: 117.2834, latitude: 34.2044 },
                "å¸¸å·å¸‚": { longitude: 119.9734, latitude: 31.7797 },
                "è˜‡å·å¸‚": { longitude: 120.5854, latitude: 31.2989 },
                "å—é€šå¸‚": { longitude: 120.8944, latitude: 31.9801 },
                "é€£é›²æ¸¯å¸‚": { longitude: 119.2214, latitude: 34.5969 },
                "æ·®å®‰å¸‚": { longitude: 119.0154, latitude: 33.5975 },
                "é¹½åŸå¸‚": { longitude: 120.1394, latitude: 33.3776 },
                "æšå·å¸‚": { longitude: 119.4124, latitude: 32.3931 },
                "é®æ±Ÿå¸‚": { longitude: 119.4524, latitude: 32.2044 },
                "æ³°å·å¸‚": { longitude: 119.9154, latitude: 32.4848 },
                "å®¿é·å¸‚": { longitude: 118.2754, latitude: 33.9630 }
            },
            "æµ™æ±Ÿçœ": {
                "æ­å·å¸‚": { longitude: 120.1534, latitude: 30.2874 },
                "å¯§æ³¢å¸‚": { longitude: 121.5444, latitude: 29.8683 },
                "æº«å·å¸‚": { longitude: 120.6994, latitude: 28.0005 },
                "å˜‰èˆˆå¸‚": { longitude: 120.7504, latitude: 30.7626 },
                "æ¹–å·å¸‚": { longitude: 120.0884, latitude: 30.8930 },
                "ç´¹èˆˆå¸‚": { longitude: 120.5824, latitude: 29.9970 },
                "é‡‘è¯å¸‚": { longitude: 119.6474, latitude: 29.0790 },
                "è¡¢å·å¸‚": { longitude: 118.8724, latitude: 28.9706 },
                "èˆŸå±±å¸‚": { longitude: 122.2074, latitude: 29.9852 },
                "å°å·å¸‚": { longitude: 121.4204, latitude: 28.6564 },
                "éº—æ°´å¸‚": { longitude: 119.9164, latitude: 28.4519 }
            },
            "å››å·çœ": {
                "æˆéƒ½å¸‚": { longitude: 104.0664, latitude: 30.5728 },
                "è‡ªè²¢å¸‚": { longitude: 104.7784, latitude: 29.3392 },
                "æ”€æèŠ±å¸‚": { longitude: 101.7184, latitude: 26.5822 },
                "ç€˜å·å¸‚": { longitude: 105.4434, latitude: 28.8718 },
                "å¾·é™½å¸‚": { longitude: 104.3974, latitude: 31.1268 },
                "ç¶¿é™½å¸‚": { longitude: 104.6794, latitude: 31.4678 },
                "å»£å…ƒå¸‚": { longitude: 105.8294, latitude: 32.4337 },
                "é‚å¯§å¸‚": { longitude: 105.5924, latitude: 30.5328 },
                "å…§æ±Ÿå¸‚": { longitude: 105.0584, latitude: 29.5802 },
                "æ¨‚å±±å¸‚": { longitude: 103.7654, latitude: 29.5522 },
                "å—å……å¸‚": { longitude: 106.1104, latitude: 30.8378 },
                "çœ‰å±±å¸‚": { longitude: 103.8314, latitude: 30.0481 },
                "å®œè³“å¸‚": { longitude: 104.6214, latitude: 28.7518 },
                "å»£å®‰å¸‚": { longitude: 106.6334, latitude: 30.4559 },
                "é”å·å¸‚": { longitude: 107.5024, latitude: 31.2096 },
                "é›…å®‰å¸‚": { longitude: 103.0014, latitude: 29.9797 },
                "å·´ä¸­å¸‚": { longitude: 106.7534, latitude: 31.8588 },
                "è³‡é™½å¸‚": { longitude: 104.6414, latitude: 30.1286 }
            },
            "å±±æ±çœ": {
                "æ¿Ÿå—å¸‚": { longitude: 117.1204, latitude: 36.6512 },
                "é’å³¶å¸‚": { longitude: 120.3824, latitude: 36.0671 },
                "æ·„åšå¸‚": { longitude: 118.0544, latitude: 36.8134 },
                "æ£—èŠå¸‚": { longitude: 117.3234, latitude: 34.8104 },
                "æ±ç‡Ÿå¸‚": { longitude: 118.6744, latitude: 37.4337 },
                "ç…™å°å¸‚": { longitude: 121.3914, latitude: 37.5392 },
                "æ¿°åŠå¸‚": { longitude: 119.1614, latitude: 36.7062 },
                "æ¿Ÿå¯§å¸‚": { longitude: 116.5874, latitude: 35.4146 },
                "æ³°å®‰å¸‚": { longitude: 117.0884, latitude: 36.1999 },
                "å¨æµ·å¸‚": { longitude: 122.1214, latitude: 37.5132 },
                "æ—¥ç…§å¸‚": { longitude: 119.5264, latitude: 35.4162 },
                "è‡¨æ²‚å¸‚": { longitude: 118.3564, latitude: 35.1046 },
                "å¾·å·å¸‚": { longitude: 116.3574, latitude: 37.4512 },
                "èŠåŸå¸‚": { longitude: 115.9854, latitude: 36.4560 },
                "æ¿±å·å¸‚": { longitude: 118.0164, latitude: 37.3835 },
                "èæ¾¤å¸‚": { longitude: 115.4694, latitude: 35.2465 }
            },
            "æ²³å—çœ": {
                "é„­å·å¸‚": { longitude: 113.6654, latitude: 34.7579 },
                "é–‹å°å¸‚": { longitude: 114.3074, latitude: 34.7970 },
                "æ´›é™½å¸‚": { longitude: 112.4544, latitude: 34.6196 },
                "å¹³é ‚å±±å¸‚": { longitude: 113.3074, latitude: 33.7352 },
                "å®‰é™½å¸‚": { longitude: 114.3524, latitude: 36.1034 },
                "é¶´å£å¸‚": { longitude: 114.2954, latitude: 35.7482 },
                "æ–°é„‰å¸‚": { longitude: 113.9264, latitude: 35.3030 },
                "ç„¦ä½œå¸‚": { longitude: 113.2414, latitude: 35.2156 },
                "æ¿®é™½å¸‚": { longitude: 115.0294, latitude: 35.7618 },
                "è¨±æ˜Œå¸‚": { longitude: 113.8524, latitude: 34.0359 },
                "æ¼¯æ²³å¸‚": { longitude: 114.0164, latitude: 33.5814 },
                "ä¸‰é–€å³½å¸‚": { longitude: 111.2004, latitude: 34.7726 },
                "å—é™½å¸‚": { longitude: 112.5284, latitude: 32.9907 },
                "å•†ä¸˜å¸‚": { longitude: 115.6534, latitude: 34.4370 },
                "ä¿¡é™½å¸‚": { longitude: 114.0924, latitude: 32.1471 },
                "å‘¨å£å¸‚": { longitude: 114.6964, latitude: 33.6261 },
                "é§é¦¬åº—å¸‚": { longitude: 114.0224, latitude: 32.9771 }
            },
            "æ¹–åŒ—çœ": {
                "æ­¦æ¼¢å¸‚": { longitude: 114.3054, latitude: 30.5927 },
                "é»ƒçŸ³å¸‚": { longitude: 115.0384, latitude: 30.1996 },
                "åå °å¸‚": { longitude: 110.7874, latitude: 32.6369 },
                "å®œæ˜Œå¸‚": { longitude: 111.2864, latitude: 30.6919 },
                "è¥„é™½å¸‚": { longitude: 112.1444, latitude: 32.0424 },
                "é„‚å·å¸‚": { longitude: 114.8944, latitude: 30.3905 },
                "èŠé–€å¸‚": { longitude: 112.1994, latitude: 31.0354 },
                "å­æ„Ÿå¸‚": { longitude: 113.9164, latitude: 30.9245 },
                "èŠå·å¸‚": { longitude: 112.2394, latitude: 30.3348 },
                "é»ƒå²¡å¸‚": { longitude: 114.8724, latitude: 30.4534 },
                "å’¸å¯§å¸‚": { longitude: 114.3224, latitude: 29.8412 },
                "éš¨å·å¸‚": { longitude: 113.3824, latitude: 31.6901 }
            },
            "æ¹–å—çœ": {
                "é•·æ²™å¸‚": { longitude: 112.9384, latitude: 28.2277 },
                "æ ªæ´²å¸‚": { longitude: 113.1334, latitude: 27.8279 },
                "æ¹˜æ½­å¸‚": { longitude: 112.9444, latitude: 27.8297 },
                "è¡¡é™½å¸‚": { longitude: 112.5714, latitude: 26.8932 },
                "é‚µé™½å¸‚": { longitude: 111.4674, latitude: 27.2388 },
                "å²³é™½å¸‚": { longitude: 113.1284, latitude: 29.3572 },
                "å¸¸å¾·å¸‚": { longitude: 111.6984, latitude: 29.0314 },
                "å¼µå®¶ç•Œå¸‚": { longitude: 110.4794, latitude: 29.1274 },
                "ç›Šé™½å¸‚": { longitude: 112.3544, latitude: 28.5539 },
                "éƒ´å·å¸‚": { longitude: 113.0144, latitude: 25.7706 },
                "æ°¸å·å¸‚": { longitude: 111.6124, latitude: 26.4203 },
                "æ‡·åŒ–å¸‚": { longitude: 109.9784, latitude: 27.5494 },
                "å©åº•å¸‚": { longitude: 111.9934, latitude: 27.6974 }
            },
            "ç¦å»ºçœ": {
                "ç¦å·å¸‚": { longitude: 119.2964, latitude: 26.0745 },
                "å»ˆé–€å¸‚": { longitude: 118.1104, latitude: 24.4798 },
                "è†ç”°å¸‚": { longitude: 119.0074, latitude: 25.4540 },
                "ä¸‰æ˜å¸‚": { longitude: 117.6384, latitude: 26.2650 },
                "æ³‰å·å¸‚": { longitude: 118.6754, latitude: 24.8739 },
                "æ¼³å·å¸‚": { longitude: 117.6474, latitude: 24.5129 },
                "å—å¹³å¸‚": { longitude: 118.1774, latitude: 26.6415 },
                "é¾å²©å¸‚": { longitude: 117.0174, latitude: 25.0916 },
                "å¯§å¾·å¸‚": { longitude: 119.5274, latitude: 26.6592 }
            },
            "å®‰å¾½çœ": {
                "åˆè‚¥å¸‚": { longitude: 117.2274, latitude: 31.8205 },
                "è•ªæ¹–å¸‚": { longitude: 118.3764, latitude: 31.3263 },
                "èšŒåŸ å¸‚": { longitude: 117.3644, latitude: 32.9406 },
                "æ·®å—å¸‚": { longitude: 116.9994, latitude: 32.6254 },
                "é¦¬éå±±å¸‚": { longitude: 118.5074, latitude: 31.6893 },
                "æ·®åŒ—å¸‚": { longitude: 116.7944, latitude: 33.9547 },
                "éŠ…é™µå¸‚": { longitude: 117.8124, latitude: 30.9453 },
                "å®‰æ…¶å¸‚": { longitude: 117.0534, latitude: 30.5255 },
                "é»ƒå±±å¸‚": { longitude: 118.3374, latitude: 29.7146 },
                "æ»å·å¸‚": { longitude: 118.3164, latitude: 32.3015 },
                "é˜œé™½å¸‚": { longitude: 115.8194, latitude: 32.8969 },
                "å®¿å·å¸‚": { longitude: 116.9784, latitude: 33.6338 },
                "å…­å®‰å¸‚": { longitude: 116.5074, latitude: 31.7528 },
                "äº³å·å¸‚": { longitude: 115.7784, latitude: 33.8693 },
                "æ± å·å¸‚": { longitude: 117.4914, latitude: 30.6647 },
                "å®£åŸå¸‚": { longitude: 118.7584, latitude: 30.9455 }
            },
            "æ²³åŒ—çœ": {
                "çŸ³å®¶èŠå¸‚": { longitude: 114.5144, latitude: 38.0427 },
                "å”å±±å¸‚": { longitude: 118.1804, latitude: 39.6305 },
                "ç§¦çš‡å³¶å¸‚": { longitude: 119.6004, latitude: 39.9354 },
                "é‚¯é„²å¸‚": { longitude: 114.5384, latitude: 36.6256 },
                "é‚¢å°å¸‚": { longitude: 114.5044, latitude: 37.0705 },
                "ä¿å®šå¸‚": { longitude: 115.4644, latitude: 38.8739 },
                "å¼µå®¶å£å¸‚": { longitude: 114.8874, latitude: 40.8244 },
                "æ‰¿å¾·å¸‚": { longitude: 117.9624, latitude: 40.9547 },
                "æ»„å·å¸‚": { longitude: 116.8384, latitude: 38.3044 },
                "å»ŠåŠå¸‚": { longitude: 116.6834, latitude: 39.5380 },
                "è¡¡æ°´å¸‚": { longitude: 115.6694, latitude: 37.7389 }
            },
            "é™è¥¿çœ": {
                "è¥¿å®‰å¸‚": { longitude: 108.9394, latitude: 34.3412 },
                "éŠ…å·å¸‚": { longitude: 108.9794, latitude: 34.9087 },
                "å¯¶é›å¸‚": { longitude: 107.2374, latitude: 34.3619 },
                "å’¸é™½å¸‚": { longitude: 108.7094, latitude: 34.3296 },
                "æ¸­å—å¸‚": { longitude: 109.4894, latitude: 34.4993 },
                "å»¶å®‰å¸‚": { longitude: 109.4894, latitude: 36.5963 },
                "æ¼¢ä¸­å¸‚": { longitude: 107.0234, latitude: 33.0776 },
                "æ¦†æ—å¸‚": { longitude: 109.7344, latitude: 38.2852 },
                "å®‰åº·å¸‚": { longitude: 109.0294, latitude: 32.6903 },
                "å•†æ´›å¸‚": { longitude: 109.9374, latitude: 33.8683 }
            },
            "é¼å¯§çœ": {
                "ç€‹é™½å¸‚": { longitude: 123.4314, latitude: 41.8056 },
                "å¤§é€£å¸‚": { longitude: 121.6144, latitude: 38.9140 },
                "éå±±å¸‚": { longitude: 122.9944, latitude: 41.1077 },
                "æ’«é †å¸‚": { longitude: 123.9574, latitude: 41.8808 },
                "æœ¬æºªå¸‚": { longitude: 123.7654, latitude: 41.2979 },
                "ä¸¹æ±å¸‚": { longitude: 124.3834, latitude: 40.1292 },
                "éŒ¦å·å¸‚": { longitude: 121.1274, latitude: 41.0951 },
                "ç‡Ÿå£å¸‚": { longitude: 122.2344, latitude: 40.6669 },
                "é˜œæ–°å¸‚": { longitude: 121.6704, latitude: 42.0216 },
                "é¼é™½å¸‚": { longitude: 123.1814, latitude: 41.2694 },
                "ç›¤éŒ¦å¸‚": { longitude: 122.0704, latitude: 41.1199 },
                "éµå¶ºå¸‚": { longitude: 123.8424, latitude: 42.2906 },
                "æœé™½å¸‚": { longitude: 120.4514, latitude: 41.5767 },
                "è‘«è˜†å³¶å¸‚": { longitude: 120.8364, latitude: 40.7110 }
            },
            "å‰æ—çœ": {
                "é•·æ˜¥å¸‚": { longitude: 125.3234, latitude: 43.8170 },
                "å‰æ—å¸‚": { longitude: 126.5494, latitude: 43.8378 },
                "å››å¹³å¸‚": { longitude: 124.3504, latitude: 43.1664 },
                "é¼æºå¸‚": { longitude: 125.1434, latitude: 42.8877 },
                "é€šåŒ–å¸‚": { longitude: 125.9364, latitude: 41.7281 },
                "ç™½å±±å¸‚": { longitude: 126.4234, latitude: 41.9409 },
                "æ¾åŸå¸‚": { longitude: 124.8254, latitude: 45.1410 },
                "ç™½åŸå¸‚": { longitude: 122.8384, latitude: 45.6196 }
            },
            "é»‘é¾æ±Ÿçœ": {
                "å“ˆçˆ¾æ¿±å¸‚": { longitude: 126.5354, latitude: 45.8021 },
                "é½Šé½Šå“ˆçˆ¾å¸‚": { longitude: 123.9574, latitude: 47.3543 },
                "é›è¥¿å¸‚": { longitude: 130.9694, latitude: 45.2950 },
                "é¶´å´—å¸‚": { longitude: 130.2774, latitude: 47.3319 },
                "é›™é´¨å±±å¸‚": { longitude: 131.1584, latitude: 46.6469 },
                "å¤§æ…¶å¸‚": { longitude: 125.1034, latitude: 46.5875 },
                "ä¼Šæ˜¥å¸‚": { longitude: 128.8994, latitude: 47.7275 },
                "ä½³æœ¨æ–¯å¸‚": { longitude: 130.3614, latitude: 46.8096 },
                "ä¸ƒå°æ²³å¸‚": { longitude: 131.0054, latitude: 45.7706 },
                "ç‰¡ä¸¹æ±Ÿå¸‚": { longitude: 129.6324, latitude: 44.5516 },
                "é»‘æ²³å¸‚": { longitude: 127.5284, latitude: 50.2450 },
                "ç¶åŒ–å¸‚": { longitude: 126.9684, latitude: 46.6534 }
            },
            "æ±Ÿè¥¿çœ": {
                "å—æ˜Œå¸‚": { longitude: 115.8924, latitude: 28.6820 },
                "æ™¯å¾·é®å¸‚": { longitude: 117.2144, latitude: 29.2926 },
                "èé„‰å¸‚": { longitude: 113.8544, latitude: 27.6229 },
                "ä¹æ±Ÿå¸‚": { longitude: 115.9924, latitude: 29.7050 },
                "æ–°é¤˜å¸‚": { longitude: 114.9174, latitude: 27.8174 },
                "é·¹æ½­å¸‚": { longitude: 117.0694, latitude: 28.2601 },
                "è´›å·å¸‚": { longitude: 114.9344, latitude: 25.8303 },
                "å‰å®‰å¸‚": { longitude: 114.9924, latitude: 27.1134 },
                "å®œæ˜¥å¸‚": { longitude: 114.3914, latitude: 27.8043 },
                "æ’«å·å¸‚": { longitude: 116.3584, latitude: 27.9492 },
                "ä¸Šé¥’å¸‚": { longitude: 117.9434, latitude: 28.4549 }
            },
            "é‡æ…¶å¸‚": {
                "è¬å·å€": { longitude: 108.4084, latitude: 30.8079 },
                "æ¶ªé™µå€": { longitude: 107.3944, latitude: 29.7030 },
                "æ¸ä¸­å€": { longitude: 106.5624, latitude: 29.5527 },
                "å¤§æ¸¡å£å€": { longitude: 106.4824, latitude: 29.4844 },
                "æ±ŸåŒ—å€": { longitude: 106.5744, latitude: 29.6067 },
                "æ²™åªå£©å€": { longitude: 106.4544, latitude: 29.5409 },
                "ä¹é¾å¡å€": { longitude: 106.5104, latitude: 29.5023 },
                "å—å²¸å€": { longitude: 106.5634, latitude: 29.5239 },
                "åŒ—ç¢šå€": { longitude: 106.4374, latitude: 29.8254 },
                "ç¶¦æ±Ÿå€": { longitude: 106.6514, latitude: 29.0280 },
                "å¤§è¶³å€": { longitude: 105.7214, latitude: 29.7070 },
                "ç’§å±±å€": { longitude: 106.2274, latitude: 29.5920 },
                "éŠ…æ¢å€": { longitude: 106.0544, latitude: 29.8449 },
                "æ½¼å—å€": { longitude: 105.8404, latitude: 30.1905 },
                "æ¦®æ˜Œå€": { longitude: 105.5944, latitude: 29.4050 }
            },
            "å¤©æ´¥å¸‚": {
                "å’Œå¹³å€": { longitude: 117.2144, latitude: 39.1171 },
                "æ²³æ±å€": { longitude: 117.2514, latitude: 39.1280 },
                "æ²³è¥¿å€": { longitude: 117.2234, latitude: 39.1095 },
                "å—é–‹å€": { longitude: 117.1504, latitude: 39.1381 },
                "æ²³åŒ—å€": { longitude: 117.1964, latitude: 39.1478 },
                "ç´…æ©‹å€": { longitude: 117.1634, latitude: 39.1753 },
                "æ±éº—å€": { longitude: 117.3134, latitude: 39.0864 },
                "è¥¿é’å€": { longitude: 117.0124, latitude: 39.1414 },
                "æ´¥å—å€": { longitude: 117.3824, latitude: 38.9839 },
                "åŒ—è¾°å€": { longitude: 117.1344, latitude: 39.2217 },
                "æ­¦æ¸…å€": { longitude: 117.0444, latitude: 39.3840 },
                "å¯¶å»å€": { longitude: 117.3084, latitude: 39.7173 },
                "æ¿±æµ·æ–°å€": { longitude: 117.7104, latitude: 39.0037 },
                "å¯§æ²³å€": { longitude: 117.8254, latitude: 39.3308 },
                "éœæµ·å€": { longitude: 116.9744, latitude: 38.9358 },
                "è–Šå·å€": { longitude: 117.4074, latitude: 40.0457 }
            }
        };

        // å°ç£ç¸£å¸‚å’Œå€åŸŸæ•¸æ“šï¼ˆåŒ…å«ç¶“ç·¯åº¦ï¼‰
        const taiwanLocations = {
            "è‡ºåŒ—å¸‚": {
                "ä¸­æ­£å€": { longitude: 121.5194, latitude: 25.0324 },
                "å¤§åŒå€": { longitude: 121.5138, latitude: 25.0626 },
                "ä¸­å±±å€": { longitude: 121.5277, latitude: 25.0642 },
                "æ¾å±±å€": { longitude: 121.5769, latitude: 25.0575 },
                "å¤§å®‰å€": { longitude: 121.5439, latitude: 25.0259 },
                "è¬è¯å€": { longitude: 121.5004, latitude: 25.0315 },
                "ä¿¡ç¾©å€": { longitude: 121.5717, latitude: 25.0330 },
                "å£«æ—å€": { longitude: 121.5267, latitude: 25.0924 },
                "åŒ—æŠ•å€": { longitude: 121.4988, latitude: 25.1327 },
                "å…§æ¹–å€": { longitude: 121.5889, latitude: 25.0696 },
                "å—æ¸¯å€": { longitude: 121.6075, latitude: 25.0543 },
                "æ–‡å±±å€": { longitude: 121.5700, latitude: 24.9891 }
            },
            "æ–°åŒ—å¸‚": {
                "æ¿æ©‹å€": { longitude: 121.4591, latitude: 25.0081 },
                "ä¸‰é‡å€": { longitude: 121.4849, latitude: 25.0621 },
                "ä¸­å’Œå€": { longitude: 121.4924, latitude: 24.9965 },
                "æ°¸å’Œå€": { longitude: 121.5136, latitude: 25.0118 },
                "æ–°èŠå€": { longitude: 121.4426, latitude: 25.0335 },
                "æ–°åº—å€": { longitude: 121.5377, latitude: 24.9564 },
                "æ¨¹æ—å€": { longitude: 121.4244, latitude: 24.9910 },
                "é¶¯æ­Œå€": { longitude: 121.3545, latitude: 24.9551 },
                "ä¸‰å³½å€": { longitude: 121.3690, latitude: 24.9341 },
                "æ·¡æ°´å€": { longitude: 121.4434, latitude: 25.1674 },
                "æ±æ­¢å€": { longitude: 121.6560, latitude: 25.0677 },
                "ç‘èŠ³å€": { longitude: 121.8056, latitude: 25.1092 },
                "åœŸåŸå€": { longitude: 121.4449, latitude: 24.9733 },
                "è˜†æ´²å€": { longitude: 121.4737, latitude: 25.0831 },
                "äº”è‚¡å€": { longitude: 121.4367, latitude: 25.0834 },
                "æ³°å±±å€": { longitude: 121.4286, latitude: 25.0576 },
                "æ—å£å€": { longitude: 121.3897, latitude: 25.0779 },
                "æ·±å‘å€": { longitude: 121.6152, latitude: 25.0019 },
                "çŸ³ç¢‡å€": { longitude: 121.6608, latitude: 24.9915 },
                "åªæ—å€": { longitude: 121.7121, latitude: 24.9371 },
                "ä¸‰èŠå€": { longitude: 121.5012, latitude: 25.2584 },
                "çŸ³é–€å€": { longitude: 121.5681, latitude: 25.2912 },
                "å…«é‡Œå€": { longitude: 121.3990, latitude: 25.1469 },
                "å¹³æºªå€": { longitude: 121.7806, latitude: 25.0256 },
                "é›™æºªå€": { longitude: 121.8657, latitude: 25.0385 },
                "è²¢å¯®å€": { longitude: 121.9225, latitude: 25.0215 },
                "é‡‘å±±å€": { longitude: 121.6384, latitude: 25.2211 },
                "è¬é‡Œå€": { longitude: 121.6895, latitude: 25.1793 },
                "çƒä¾†å€": { longitude: 121.5510, latitude: 24.8632 }
            },
            "æ¡ƒåœ’å¸‚": {
                "æ¡ƒåœ’å€": { longitude: 121.3010, latitude: 24.9936 },
                "ä¸­å£¢å€": { longitude: 121.2249, latitude: 24.9544 },
                "å¤§æºªå€": { longitude: 121.2868, latitude: 24.8844 },
                "æ¥Šæ¢…å€": { longitude: 121.1462, latitude: 24.9087 },
                "è˜†ç«¹å€": { longitude: 121.2933, latitude: 25.0479 },
                "å¤§åœ’å€": { longitude: 121.1995, latitude: 25.0649 },
                "é¾œå±±å€": { longitude: 121.3397, latitude: 25.0179 },
                "å…«å¾·å€": { longitude: 121.2840, latitude: 24.9267 },
                "é¾æ½­å€": { longitude: 121.2124, latitude: 24.8633 },
                "å¹³é®å€": { longitude: 121.2180, latitude: 24.9453 },
                "æ–°å±‹å€": { longitude: 121.0618, latitude: 24.9696 },
                "è§€éŸ³å€": { longitude: 121.0794, latitude: 25.0317 },
                "å¾©èˆˆå€": { longitude: 121.3526, latitude: 24.8182 }
            },
            "è‡ºä¸­å¸‚": {
                "ä¸­å€": { longitude: 120.6790, latitude: 24.1418 },
                "æ±å€": { longitude: 120.6972, latitude: 24.1388 },
                "å—å€": { longitude: 120.6614, latitude: 24.1261 },
                "è¥¿å€": { longitude: 120.6634, latitude: 24.1446 },
                "åŒ—å€": { longitude: 120.6792, latitude: 24.1582 },
                "è¥¿å±¯å€": { longitude: 120.6384, latitude: 24.1788 },
                "å—å±¯å€": { longitude: 120.6432, latitude: 24.1346 },
                "åŒ—å±¯å€": { longitude: 120.6976, latitude: 24.1834 },
                "è±åŸå€": { longitude: 120.7207, latitude: 24.2518 },
                "æ±å‹¢å€": { longitude: 120.8274, latitude: 24.2587 },
                "å¤§ç”²å€": { longitude: 120.6224, latitude: 24.3457 },
                "æ¸…æ°´å€": { longitude: 120.5693, latitude: 24.2686 },
                "æ²™é¹¿å€": { longitude: 120.5657, latitude: 24.2337 },
                "æ¢§æ£²å€": { longitude: 120.5306, latitude: 24.2548 },
                "åé‡Œå€": { longitude: 120.7299, latitude: 24.3095 },
                "ç¥å²¡å€": { longitude: 120.6614, latitude: 24.2568 },
                "æ½­å­å€": { longitude: 120.7050, latitude: 24.2118 },
                "å¤§é›…å€": { longitude: 120.6500, latitude: 24.2272 },
                "æ–°ç¤¾å€": { longitude: 120.8098, latitude: 24.2344 },
                "çŸ³å²¡å€": { longitude: 120.7779, latitude: 24.2746 },
                "å¤–åŸ”å€": { longitude: 120.6538, latitude: 24.3319 },
                "å¤§å®‰å€": { longitude: 120.5866, latitude: 24.3456 },
                "çƒæ—¥å€": { longitude: 120.6234, latitude: 24.1048 },
                "å¤§è‚šå€": { longitude: 120.5444, latitude: 24.1477 },
                "é¾äº•å€": { longitude: 120.5454, latitude: 24.1883 },
                "éœ§å³°å€": { longitude: 120.6986, latitude: 24.0615 },
                "å¤ªå¹³å€": { longitude: 120.7185, latitude: 24.1262 },
                "å¤§é‡Œå€": { longitude: 120.6794, latitude: 24.0989 },
                "å’Œå¹³å€": { longitude: 121.0210, latitude: 24.3103 }
            },
            "è‡ºå—å¸‚": {
                "ä¸­è¥¿å€": { longitude: 120.1960, latitude: 22.9924 },
                "æ±å€": { longitude: 120.2280, latitude: 22.9812 },
                "å—å€": { longitude: 120.1883, latitude: 22.9473 },
                "åŒ—å€": { longitude: 120.2089, latitude: 23.0103 },
                "å®‰å¹³å€": { longitude: 120.1628, latitude: 22.9872 },
                "å®‰å—å€": { longitude: 120.1587, latitude: 23.0460 },
                "æ°¸åº·å€": { longitude: 120.2579, latitude: 23.0268 },
                "æ­¸ä»å€": { longitude: 120.2938, latitude: 22.9691 },
                "æ–°åŒ–å€": { longitude: 120.3097, latitude: 23.0372 },
                "å·¦é®å€": { longitude: 120.4084, latitude: 23.0571 },
                "ç‰äº•å€": { longitude: 120.4614, latitude: 23.1233 },
                "æ¥ è¥¿å€": { longitude: 120.4844, latitude: 23.1838 },
                "å—åŒ–å€": { longitude: 120.4770, latitude: 23.0422 },
                "ä»å¾·å€": { longitude: 120.2513, latitude: 22.9696 },
                "é—œå»Ÿå€": { longitude: 120.3268, latitude: 22.9622 },
                "é¾å´å€": { longitude: 120.3605, latitude: 22.9584 },
                "å®˜ç”°å€": { longitude: 120.3164, latitude: 23.1936 },
                "éº»è±†å€": { longitude: 120.2474, latitude: 23.1814 },
                "ä½³é‡Œå€": { longitude: 120.1732, latitude: 23.1673 },
                "è¥¿æ¸¯å€": { longitude: 120.2032, latitude: 23.1229 },
                "ä¸ƒè‚¡å€": { longitude: 120.1088, latitude: 23.1342 },
                "å°‡è»å€": { longitude: 120.1272, latitude: 23.2044 },
                "å­¸ç”²å€": { longitude: 120.1802, latitude: 23.2324 },
                "åŒ—é–€å€": { longitude: 120.1251, latitude: 23.2672 },
                "æ–°ç‡Ÿå€": { longitude: 120.3159, latitude: 23.3078 },
                "å¾Œå£å€": { longitude: 120.3636, latitude: 23.3651 },
                "ç™½æ²³å€": { longitude: 120.4165, latitude: 23.3506 },
                "æ±å±±å€": { longitude: 120.4084, latitude: 23.3264 },
                "å…­ç”²å€": { longitude: 120.3714, latitude: 23.2306 },
                "ä¸‹ç‡Ÿå€": { longitude: 120.2644, latitude: 23.2331 },
                "æŸ³ç‡Ÿå€": { longitude: 120.3103, latitude: 23.2781 },
                "é¹½æ°´å€": { longitude: 120.2663, latitude: 23.3201 },
                "å–„åŒ–å€": { longitude: 120.2963, latitude: 23.1314 },
                "å¤§å…§å€": { longitude: 120.4134, latitude: 23.1194 },
                "å±±ä¸Šå€": { longitude: 120.3552, latitude: 23.1033 },
                "æ–°å¸‚å€": { longitude: 120.2952, latitude: 23.0789 },
                "å®‰å®šå€": { longitude: 120.2362, latitude: 23.1214 }
            },
            "é«˜é›„å¸‚": {
                "æ–°èˆˆå€": { longitude: 120.3094, latitude: 22.6308 },
                "å‰é‡‘å€": { longitude: 120.2924, latitude: 22.6278 },
                "è‹“é›…å€": { longitude: 120.3204, latitude: 22.6208 },
                "é¹½åŸ•å€": { longitude: 120.2844, latitude: 22.6258 },
                "é¼“å±±å€": { longitude: 120.2754, latitude: 22.6308 },
                "æ——æ´¥å€": { longitude: 120.2844, latitude: 22.6108 },
                "å‰é®å€": { longitude: 120.3174, latitude: 22.5988 },
                "ä¸‰æ°‘å€": { longitude: 120.3184, latitude: 22.6458 },
                "å·¦ç‡Ÿå€": { longitude: 120.2944, latitude: 22.6878 },
                "æ¥ æ¢“å€": { longitude: 120.3264, latitude: 22.7308 },
                "å°æ¸¯å€": { longitude: 120.3574, latitude: 22.5658 },
                "é³³å±±å€": { longitude: 120.3564, latitude: 22.6278 },
                "æ—åœ’å€": { longitude: 120.3934, latitude: 22.5088 },
                "å¤§å¯®å€": { longitude: 120.3934, latitude: 22.6058 },
                "å¤§æ¨¹å€": { longitude: 120.4324, latitude: 22.6978 },
                "å¤§ç¤¾å€": { longitude: 120.3644, latitude: 22.7278 },
                "ä»æ­¦å€": { longitude: 120.3474, latitude: 22.7018 },
                "é³¥æ¾å€": { longitude: 120.3744, latitude: 22.6608 },
                "å²¡å±±å€": { longitude: 120.2944, latitude: 22.7978 },
                "æ©‹é ­å€": { longitude: 120.3094, latitude: 22.7578 },
                "ç‡•å·¢å€": { longitude: 120.3614, latitude: 22.7938 },
                "ç”°å¯®å€": { longitude: 120.3934, latitude: 22.8678 },
                "é˜¿è“®å€": { longitude: 120.3274, latitude: 22.8778 },
                "è·¯ç«¹å€": { longitude: 120.2634, latitude: 22.8538 },
                "æ¹–å…§å€": { longitude: 120.2294, latitude: 22.9078 },
                "èŒ„è£å€": { longitude: 120.1824, latitude: 22.9078 },
                "æ°¸å®‰å€": { longitude: 120.2244, latitude: 22.8178 },
                "å½Œé™€å€": { longitude: 120.2454, latitude: 22.7838 },
                "æ¢“å®˜å€": { longitude: 120.2654, latitude: 22.7578 },
                "æ——å±±å€": { longitude: 120.4814, latitude: 22.8888 },
                "ç¾æ¿ƒå€": { longitude: 120.5474, latitude: 22.8938 },
                "å…­é¾œå€": { longitude: 120.6334, latitude: 22.9978 },
                "ç”²ä»™å€": { longitude: 120.5914, latitude: 23.0778 },
                "æ‰æ—å€": { longitude: 120.5354, latitude: 22.9578 },
                "å…§é–€å€": { longitude: 120.4714, latitude: 22.9438 },
                "èŒ‚æ—å€": { longitude: 120.6634, latitude: 22.8878 },
                "æ¡ƒæºå€": { longitude: 120.7584, latitude: 23.1878 },
                "é‚£ç‘ªå¤å€": { longitude: 120.6924, latitude: 23.2278 }
            },
            "åŸºéš†å¸‚": {
                "ä»æ„›å€": { longitude: 121.7444, latitude: 25.1278 },
                "ä¿¡ç¾©å€": { longitude: 121.7654, latitude: 25.1298 },
                "ä¸­æ­£å€": { longitude: 121.7754, latitude: 25.1388 },
                "ä¸­å±±å€": { longitude: 121.7394, latitude: 25.1488 },
                "å®‰æ¨‚å€": { longitude: 121.7244, latitude: 25.1478 },
                "æš–æš–å€": { longitude: 121.7394, latitude: 25.0988 },
                "ä¸ƒå µå€": { longitude: 121.6814, latitude: 25.0978 }
            },
            "æ–°ç«¹å¸‚": {
                "æ±å€": { longitude: 120.9754, latitude: 24.8088 },
                "åŒ—å€": { longitude: 120.9564, latitude: 24.8188 },
                "é¦™å±±å€": { longitude: 120.9244, latitude: 24.7588 }
            },
            "æ–°ç«¹ç¸£": {
                "ç«¹åŒ—å¸‚": { longitude: 120.9954, latitude: 24.8288 },
                "æ¹–å£é„‰": { longitude: 121.0444, latitude: 24.8978 },
                "æ–°è±é„‰": { longitude: 120.9844, latitude: 24.8978 },
                "æ–°åŸ”é®": { longitude: 121.0744, latitude: 24.8378 },
                "é—œè¥¿é®": { longitude: 121.1744, latitude: 24.7978 },
                "èŠæ—é„‰": { longitude: 121.0744, latitude: 24.7778 },
                "å¯¶å±±é„‰": { longitude: 120.9844, latitude: 24.7578 },
                "ç«¹æ±é®": { longitude: 121.0944, latitude: 24.7278 },
                "äº”å³°é„‰": { longitude: 121.1344, latitude: 24.6278 },
                "æ©«å±±é„‰": { longitude: 121.1544, latitude: 24.7278 },
                "å°–çŸ³é„‰": { longitude: 121.3044, latitude: 24.7078 },
                "åŒ—åŸ”é„‰": { longitude: 121.0544, latitude: 24.6978 },
                "å³¨çœ‰é„‰": { longitude: 121.0044, latitude: 24.6778 }
            },
            "è‹—æ —ç¸£": {
                "è‹—æ —å¸‚": { longitude: 120.8194, latitude: 24.5678 },
                "è‹‘è£¡é®": { longitude: 120.6544, latitude: 24.4478 },
                "é€šéœ„é®": { longitude: 120.6764, latitude: 24.4978 },
                "ç«¹å—é®": { longitude: 120.8744, latitude: 24.6878 },
                "é ­ä»½å¸‚": { longitude: 120.8944, latitude: 24.6878 },
                "å¾Œé¾é®": { longitude: 120.7864, latitude: 24.6178 },
                "å“è˜­é®": { longitude: 120.8244, latitude: 24.3078 },
                "å¤§æ¹–é„‰": { longitude: 120.8544, latitude: 24.4278 },
                "å…¬é¤¨é„‰": { longitude: 120.8244, latitude: 24.4978 },
                "éŠ…é‘¼é„‰": { longitude: 120.7844, latitude: 24.4878 },
                "å—åº„é„‰": { longitude: 121.0044, latitude: 24.5978 },
                "é ­å±‹é„‰": { longitude: 120.8444, latitude: 24.5778 },
                "ä¸‰ç¾©é„‰": { longitude: 120.7644, latitude: 24.4078 },
                "è¥¿æ¹–é„‰": { longitude: 120.7544, latitude: 24.5578 },
                "é€ æ©‹é„‰": { longitude: 120.8644, latitude: 24.6378 },
                "ä¸‰ç£é„‰": { longitude: 120.9544, latitude: 24.6478 },
                "ç…æ½­é„‰": { longitude: 120.9244, latitude: 24.5378 },
                "æ³°å®‰é„‰": { longitude: 121.0844, latitude: 24.4378 }
            },
            "å½°åŒ–ç¸£": {
                "å½°åŒ–å¸‚": { longitude: 120.5394, latitude: 24.0778 },
                "é¹¿æ¸¯é®": { longitude: 120.4344, latitude: 24.0578 },
                "å’Œç¾é®": { longitude: 120.5044, latitude: 24.1078 },
                "ç·šè¥¿é„‰": { longitude: 120.4644, latitude: 24.1278 },
                "ä¼¸æ¸¯é„‰": { longitude: 120.4844, latitude: 24.1578 },
                "ç¦èˆˆé„‰": { longitude: 120.4444, latitude: 24.0478 },
                "ç§€æ°´é„‰": { longitude: 120.5044, latitude: 24.0378 },
                "èŠ±å£‡é„‰": { longitude: 120.5444, latitude: 24.0278 },
                "èŠ¬åœ’é„‰": { longitude: 120.6244, latitude: 24.0178 },
                "å“¡æ—å¸‚": { longitude: 120.5744, latitude: 23.9578 },
                "æºªæ¹–é®": { longitude: 120.4744, latitude: 23.9578 },
                "ç”°ä¸­é®": { longitude: 120.5944, latitude: 23.8578 },
                "å¤§æ‘é„‰": { longitude: 120.5444, latitude: 23.9878 },
                "åŸ”é¹½é„‰": { longitude: 120.4644, latitude: 23.9978 },
                "åŸ”å¿ƒé„‰": { longitude: 120.5344, latitude: 23.9578 },
                "æ°¸é–é„‰": { longitude: 120.5444, latitude: 23.9278 },
                "ç¤¾é ­é„‰": { longitude: 120.5844, latitude: 23.8978 },
                "äºŒæ°´é„‰": { longitude: 120.6144, latitude: 23.8078 },
                "åŒ—æ–—é®": { longitude: 120.5244, latitude: 23.8778 },
                "äºŒæ—é®": { longitude: 120.3744, latitude: 23.8978 },
                "ç”°å°¾é„‰": { longitude: 120.5244, latitude: 23.8878 },
                "åŸ¤é ­é„‰": { longitude: 120.4644, latitude: 23.8878 },
                "èŠ³è‹‘é„‰": { longitude: 120.3244, latitude: 23.9278 },
                "å¤§åŸé„‰": { longitude: 120.3144, latitude: 23.8578 },
                "ç«¹å¡˜é„‰": { longitude: 120.4244, latitude: 23.8578 },
                "æºªå·é„‰": { longitude: 120.4944, latitude: 23.8378 }
            },
            "å—æŠ•ç¸£": {
                "å—æŠ•å¸‚": { longitude: 120.6844, latitude: 23.9078 },
                "åŸ”é‡Œé®": { longitude: 120.9644, latitude: 23.9678 },
                "è‰å±¯é®": { longitude: 120.6844, latitude: 23.9778 },
                "ç«¹å±±é®": { longitude: 120.6844, latitude: 23.7578 },
                "é›†é›†é®": { longitude: 120.7844, latitude: 23.8278 },
                "åé–“é„‰": { longitude: 120.7044, latitude: 23.8378 },
                "é¹¿è°·é„‰": { longitude: 120.7644, latitude: 23.7478 },
                "ä¸­å¯®é„‰": { longitude: 120.7644, latitude: 23.8778 },
                "é­šæ± é„‰": { longitude: 120.9244, latitude: 23.8978 },
                "åœ‹å§“é„‰": { longitude: 120.8444, latitude: 24.0278 },
                "æ°´é‡Œé„‰": { longitude: 120.8544, latitude: 23.8078 },
                "ä¿¡ç¾©é„‰": { longitude: 120.8544, latitude: 23.6978 },
                "ä»æ„›é„‰": { longitude: 121.1344, latitude: 24.0278 }
            },
            "é›²æ—ç¸£": {
                "æ–—å…­å¸‚": { longitude: 120.5444, latitude: 23.7078 },
                "æ–—å—é®": { longitude: 120.4844, latitude: 23.6778 },
                "è™å°¾é®": { longitude: 120.4344, latitude: 23.7078 },
                "è¥¿èºé®": { longitude: 120.4644, latitude: 23.7978 },
                "åœŸåº«é®": { longitude: 120.3844, latitude: 23.6778 },
                "åŒ—æ¸¯é®": { longitude: 120.3044, latitude: 23.5778 },
                "å¤å‘é„‰": { longitude: 120.5644, latitude: 23.6478 },
                "å¤§åŸ¤é„‰": { longitude: 120.4344, latitude: 23.6478 },
                "è¿æ¡é„‰": { longitude: 120.5044, latitude: 23.7578 },
                "æ—å…§é„‰": { longitude: 120.6144, latitude: 23.7578 },
                "äºŒå´™é„‰": { longitude: 120.4144, latitude: 23.7878 },
                "å´™èƒŒé„‰": { longitude: 120.3544, latitude: 23.7578 },
                "éº¥å¯®é„‰": { longitude: 120.2644, latitude: 23.7478 },
                "æ±å‹¢é„‰": { longitude: 120.2544, latitude: 23.6778 },
                "è¤’å¿ é„‰": { longitude: 120.3144, latitude: 23.6978 },
                "è‡ºè¥¿é„‰": { longitude: 120.2044, latitude: 23.7078 },
                "å…ƒé•·é„‰": { longitude: 120.3144, latitude: 23.6478 },
                "å››æ¹–é„‰": { longitude: 120.2244, latitude: 23.6378 },
                "å£æ¹–é„‰": { longitude: 120.1844, latitude: 23.5878 },
                "æ°´æ—é„‰": { longitude: 120.2444, latitude: 23.5678 }
            },
            "å˜‰ç¾©å¸‚": {
                "æ±å€": { longitude: 120.4544, latitude: 23.4878 },
                "è¥¿å€": { longitude: 120.4344, latitude: 23.4778 }
            },
            "å˜‰ç¾©ç¸£": {
                "å¤ªä¿å¸‚": { longitude: 120.3444, latitude: 23.4678 },
                "æœ´å­å¸‚": { longitude: 120.2444, latitude: 23.4678 },
                "å¸ƒè¢‹é®": { longitude: 120.1544, latitude: 23.3878 },
                "å¤§æ—é®": { longitude: 120.4544, latitude: 23.6078 },
                "æ°‘é›„é„‰": { longitude: 120.4344, latitude: 23.5578 },
                "æºªå£é„‰": { longitude: 120.3944, latitude: 23.6078 },
                "æ–°æ¸¯é„‰": { longitude: 120.3444, latitude: 23.5578 },
                "å…­è…³é„‰": { longitude: 120.2744, latitude: 23.5078 },
                "æ±çŸ³é„‰": { longitude: 120.1544, latitude: 23.4578 },
                "ç¾©ç«¹é„‰": { longitude: 120.2444, latitude: 23.3378 },
                "é¹¿è‰é„‰": { longitude: 120.3044, latitude: 23.4078 },
                "æ°´ä¸Šé„‰": { longitude: 120.3944, latitude: 23.4278 },
                "ä¸­åŸ”é„‰": { longitude: 120.5244, latitude: 23.4278 },
                "ç«¹å´é„‰": { longitude: 120.5544, latitude: 23.5078 },
                "æ¢…å±±é„‰": { longitude: 120.5644, latitude: 23.5778 },
                "ç•ªè·¯é„‰": { longitude: 120.5644, latitude: 23.4778 },
                "å¤§åŸ”é„‰": { longitude: 120.5944, latitude: 23.2978 },
                "é˜¿é‡Œå±±é„‰": { longitude: 120.7444, latitude: 23.5078 }
            },
            "å±æ±ç¸£": {
                "å±æ±å¸‚": { longitude: 120.4944, latitude: 22.6778 },
                "æ½®å·é®": { longitude: 120.5444, latitude: 22.5478 },
                "æ±æ¸¯é®": { longitude: 120.4544, latitude: 22.4678 },
                "æ†æ˜¥é®": { longitude: 120.7444, latitude: 22.0078 },
                "è¬ä¸¹é„‰": { longitude: 120.4844, latitude: 22.5878 },
                "é•·æ²»é„‰": { longitude: 120.5244, latitude: 22.6878 },
                "éºŸæ´›é„‰": { longitude: 120.5244, latitude: 22.6478 },
                "ä¹å¦‚é„‰": { longitude: 120.4944, latitude: 22.7278 },
                "é‡Œæ¸¯é„‰": { longitude: 120.4944, latitude: 22.7778 },
                "é¹½åŸ”é„‰": { longitude: 120.5644, latitude: 22.7578 },
                "é«˜æ¨¹é„‰": { longitude: 120.5944, latitude: 22.8278 },
                "è¬å·’é„‰": { longitude: 120.5644, latitude: 22.5778 },
                "å…§åŸ”é„‰": { longitude: 120.5644, latitude: 22.6178 },
                "ç«¹ç”°é„‰": { longitude: 120.5244, latitude: 22.5778 },
                "æ–°åŸ¤é„‰": { longitude: 120.5444, latitude: 22.4778 },
                "æ‹å¯®é„‰": { longitude: 120.5944, latitude: 22.3778 },
                "æ–°åœ’é„‰": { longitude: 120.4544, latitude: 22.5378 },
                "å´é ‚é„‰": { longitude: 120.5144, latitude: 22.5078 },
                "æ—é‚Šé„‰": { longitude: 120.5144, latitude: 22.4378 },
                "å—å·é„‰": { longitude: 120.5144, latitude: 22.4878 },
                "ä½³å†¬é„‰": { longitude: 120.5444, latitude: 22.4178 },
                "ç‰çƒé„‰": { longitude: 120.3744, latitude: 22.3478 },
                "è»ŠåŸé„‰": { longitude: 120.7144, latitude: 22.0678 },
                "æ»¿å·é„‰": { longitude: 120.8144, latitude: 22.0278 },
                "æ‹å±±é„‰": { longitude: 120.6544, latitude: 22.2578 },
                "ä¸‰åœ°é–€é„‰": { longitude: 120.6544, latitude: 22.7178 },
                "éœ§å°é„‰": { longitude: 120.7344, latitude: 22.7478 },
                "ç‘ªå®¶é„‰": { longitude: 120.6544, latitude: 22.6478 },
                "æ³°æ­¦é„‰": { longitude: 120.6344, latitude: 22.5878 },
                "ä¾†ç¾©é„‰": { longitude: 120.6744, latitude: 22.5278 },
                "æ˜¥æ—¥é„‰": { longitude: 120.6244, latitude: 22.3778 },
                "ç…å­é„‰": { longitude: 120.7044, latitude: 22.2078 },
                "ç‰¡ä¸¹é„‰": { longitude: 120.7944, latitude: 22.1278 }
            },
            "å®œè˜­ç¸£": {
                "å®œè˜­å¸‚": { longitude: 121.7544, latitude: 24.7578 },
                "ç¾…æ±é®": { longitude: 121.7744, latitude: 24.6778 },
                "è˜‡æ¾³é®": { longitude: 121.8544, latitude: 24.5978 },
                "é ­åŸé®": { longitude: 121.8244, latitude: 24.8578 },
                "ç¤æºªé„‰": { longitude: 121.7744, latitude: 24.8278 },
                "å£¯åœé„‰": { longitude: 121.8044, latitude: 24.7578 },
                "å“¡å±±é„‰": { longitude: 121.7344, latitude: 24.7478 },
                "å†¬å±±é„‰": { longitude: 121.7944, latitude: 24.6378 },
                "äº”çµé„‰": { longitude: 121.8044, latitude: 24.6878 },
                "ä¸‰æ˜Ÿé„‰": { longitude: 121.6644, latitude: 24.6678 },
                "å¤§åŒé„‰": { longitude: 121.6044, latitude: 24.5778 },
                "å—æ¾³é„‰": { longitude: 121.7944, latitude: 24.4578 }
            },
            "èŠ±è“®ç¸£": {
                "èŠ±è“®å¸‚": { longitude: 121.6044, latitude: 23.9778 },
                "é³³æ—é®": { longitude: 121.4544, latitude: 23.7478 },
                "ç‰é‡Œé®": { longitude: 121.3144, latitude: 23.3378 },
                "æ–°åŸé„‰": { longitude: 121.6544, latitude: 24.0278 },
                "å‰å®‰é„‰": { longitude: 121.5744, latitude: 23.9578 },
                "å£½è±é„‰": { longitude: 121.5144, latitude: 23.8678 },
                "å…‰å¾©é„‰": { longitude: 121.4244, latitude: 23.6578 },
                "è±æ¿±é„‰": { longitude: 121.5144, latitude: 23.5978 },
                "ç‘ç©—é„‰": { longitude: 121.3744, latitude: 23.4978 },
                "å¯Œé‡Œé„‰": { longitude: 121.2544, latitude: 23.1778 },
                "ç§€æ—é„‰": { longitude: 121.6044, latitude: 24.1278 },
                "è¬æ¦®é„‰": { longitude: 121.4044, latitude: 23.7078 },
                "å“æºªé„‰": { longitude: 121.3044, latitude: 23.3478 }
            },
            "è‡ºæ±ç¸£": {
                "è‡ºæ±å¸‚": { longitude: 121.1444, latitude: 22.7578 },
                "æˆåŠŸé®": { longitude: 121.3744, latitude: 23.1078 },
                "é—œå±±é®": { longitude: 121.1644, latitude: 23.0478 },
                "å‘å—é„‰": { longitude: 121.0844, latitude: 22.7878 },
                "é¹¿é‡é„‰": { longitude: 121.1344, latitude: 22.9178 },
                "æ± ä¸Šé„‰": { longitude: 121.2144, latitude: 23.1278 },
                "æ±æ²³é„‰": { longitude: 121.3044, latitude: 22.9678 },
                "é•·æ¿±é„‰": { longitude: 121.4544, latitude: 23.3278 },
                "å¤ªéº»é‡Œé„‰": { longitude: 121.0044, latitude: 22.6078 },
                "å¤§æ­¦é„‰": { longitude: 120.8944, latitude: 22.3578 },
                "ç¶ å³¶é„‰": { longitude: 121.4744, latitude: 22.6578 },
                "æµ·ç«¯é„‰": { longitude: 121.1744, latitude: 23.1978 },
                "å»¶å¹³é„‰": { longitude: 121.0744, latitude: 22.8978 },
                "é‡‘å³°é„‰": { longitude: 120.8944, latitude: 22.5978 },
                "é”ä»é„‰": { longitude: 120.8844, latitude: 22.2978 },
                "è˜­å¶¼é„‰": { longitude: 121.5544, latitude: 22.0578 }
            },
            "æ¾æ¹–ç¸£": {
                "é¦¬å…¬å¸‚": { longitude: 119.5644, latitude: 23.5678 },
                "æ¹–è¥¿é„‰": { longitude: 119.6544, latitude: 23.5778 },
                "ç™½æ²™é„‰": { longitude: 119.5844, latitude: 23.6578 },
                "è¥¿å¶¼é„‰": { longitude: 119.5044, latitude: 23.5978 },
                "æœ›å®‰é„‰": { longitude: 119.5044, latitude: 23.3578 },
                "ä¸ƒç¾é„‰": { longitude: 119.4244, latitude: 23.2078 }
            },
            "é‡‘é–€ç¸£": {
                "é‡‘åŸé®": { longitude: 118.3244, latitude: 24.4378 },
                "é‡‘æ¹–é®": { longitude: 118.4044, latitude: 24.4478 },
                "é‡‘æ²™é®": { longitude: 118.4044, latitude: 24.4978 },
                "é‡‘å¯§é„‰": { longitude: 118.3244, latitude: 24.4578 },
                "çƒˆå¶¼é„‰": { longitude: 118.2344, latitude: 24.4278 },
                "çƒåµé„‰": { longitude: 119.4544, latitude: 24.9878 }
            },
            "é€£æ±Ÿç¸£": {
                "å—ç«¿é„‰": { longitude: 119.9444, latitude: 26.1478 },
                "åŒ—ç«¿é„‰": { longitude: 119.9844, latitude: 26.2278 },
                "è’å…‰é„‰": { longitude: 119.9344, latitude: 25.9678 },
                "æ±å¼•é„‰": { longitude: 120.4944, latitude: 26.3678 }
            }
        };

        // ç²å–ç•¶å‰é¸æ“‡çš„åœ°å€æ•¸æ“š
        function getCurrentLocationData() {
            const regionSelect = document.getElementById('region');
            if (!regionSelect) return null;
            
            const region = regionSelect.value;
            if (region === 'taiwan') {
                return taiwanLocations;
            } else if (region === 'china') {
                return chinaLocations;
            }
            return null;
        }

        // åˆå§‹åŒ–ç¸£å¸‚é¸å–®
        function initializeCountySelect() {
            const countySelect = document.getElementById('county');
            const districtSelect = document.getElementById('district');
            
            if (!countySelect || !districtSelect) {
                console.error('æ‰¾ä¸åˆ°ç¸£å¸‚æˆ–å€åŸŸé¸å–®å…ƒç´ ');
                return;
            }
            
            // æ¸…ç©ºé¸å–®
            countySelect.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡åœ°å€</option>';
            districtSelect.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡ç¸£å¸‚/çœä»½</option>';
            
            // æª¢æŸ¥æ˜¯å¦å·²é¸æ“‡åœ°å€
            const regionSelect = document.getElementById('region');
            if (!regionSelect || !regionSelect.value) {
                return; // æœªé¸æ“‡åœ°å€ï¼Œä¸å¡«å……ç¸£å¸‚é¸å–®
            }
            
            const locationData = getCurrentLocationData();
            if (!locationData) {
                return;
            }
            
            // å¡«å……ç¸£å¸‚é¸å–®
            let countyCount = 0;
            for (const county in locationData) {
                const option = document.createElement('option');
                option.value = county;
                option.textContent = county;
                countySelect.appendChild(option);
                countyCount++;
            }
            
            console.log('ç¸£å¸‚é¸å–®å·²åˆå§‹åŒ–ï¼Œå…± ' + countyCount + ' å€‹ç¸£å¸‚/çœä»½');
        }

        // ç•¶é¸æ“‡ç¸£å¸‚æ™‚ï¼Œæ›´æ–°å€åŸŸé¸å–®
        function updateDistrictSelect(county) {
            const districtSelect = document.getElementById('district');
            districtSelect.innerHTML = '<option value="">è«‹é¸æ“‡å€åŸŸ/åŸå¸‚</option>';
            
            const locationData = getCurrentLocationData();
            if (!locationData) {
                return;
            }
            
            if (county && locationData[county]) {
                for (const district in locationData[county]) {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                }
            }
        }

        // ç•¶é¸æ“‡å€åŸŸæ™‚ï¼Œæ›´æ–°ç¶“ç·¯åº¦
        function updateCoordinates(county, district) {
            const longitudeInput = document.getElementById('longitude');
            const latitudeInput = document.getElementById('latitude');
            
            if (!longitudeInput || !latitudeInput) {
                console.error('æ‰¾ä¸åˆ°ç¶“ç·¯åº¦è¼¸å…¥æ¬„ä½');
                return;
            }
            
            const locationData = getCurrentLocationData();
            if (!locationData) {
                return;
            }
            
            if (county && district && locationData[county] && locationData[county][district]) {
                const location = locationData[county][district];
                longitudeInput.value = location.longitude.toFixed(4);
                latitudeInput.value = location.latitude.toFixed(4);
                
                console.log('å·²æ›´æ–°ç¶“ç·¯åº¦:', {
                    county: county,
                    district: district,
                    longitude: longitudeInput.value,
                    latitude: latitudeInput.value
                });
            } else {
                console.warn('ç„¡æ³•æ›´æ–°ç¶“ç·¯åº¦:', { county, district, 
                    hasCounty: !!county, 
                    hasDistrict: !!district,
                    hasLocationData: !!(county && locationData && locationData[county]),
                    hasDistrictData: !!(county && district && locationData && locationData[county] && locationData[county][district])
                });
            }
        }

        // ä¸­å¿ƒåç¨±æ˜ å°„
        const centerNameMap = {
            "Head": "head",
            "Ajna": "ajna",
            "Throat": "throat",
            "G": "g",
            "Ego": "ego",
            "Spleen": "spleen",
            "Sacral": "sacral",
            "Solar_Plexus": "solar-plexus",
            "Root": "root"
        };

        // é€šé“ ID æ˜ å°„å‡½æ•¸
        function getChannelId(gate1, gate2) {
            return `channel-${gate1}-${gate2}`;
        }

        // æ¸²æŸ“äººé¡åœ–çš„ä¸»è¦å‡½å¼
        function renderHumanDesign(data) {
            if (!data) {
                console.error("ç„¡æ•ˆçš„æ•¸æ“šæ ¼å¼");
                return;
            }

            // æ–‡å­—åˆ†æçµæœå·²ç§»é™¤

            // 2. æ¸²æŸ“è¡Œæ˜Ÿåˆ—è¡¨ï¼ˆå¦‚æœæ•¸æ“šåŒ…å«ï¼‰
            // æ³¨æ„ï¼šåƒæ•¸é †åºç‚º (personalityList, designList)
            // design_list é¡¯ç¤ºåœ¨å·¦å´ï¼Œpersonality_list é¡¯ç¤ºåœ¨å³å´
            if (data.design_list && data.personality_list) {
                renderPlanetLists(data.personality_list, data.design_list);
            } else {
                // å¦‚æœæ²’æœ‰æ•¸æ“šï¼Œé¡¯ç¤ºæç¤ºä¿¡æ¯
                const designContainer = document.getElementById('design-planet-list');
                const personalityContainer = document.getElementById('personality-planet-list');
                if (designContainer) {
                    designContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">æ•¸æ“šæœªæä¾›</div>';
                }
                if (personalityContainer) {
                    personalityContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">æ•¸æ“šæœªæä¾›</div>';
                }
            }
            
            // 3. æ¸²æŸ“åŸºå› å¤©å‘½ (Gene Keys)
            if (data.design_list && data.personality_list) {
                renderGeneKeys(data.personality_list, data.design_list);
            }
            
        }
        
        // ==================== åŸºå› å¤©å‘½èªªæ˜é¢æ¿åŠŸèƒ½ï¼ˆç§»åˆ° renderGeneKeys ä¹‹å‰ï¼‰====================
        
        // åŸºå› å¤©å‘½æ•¸æ“šå­˜å„²ï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰
        let geneKeysData = {};
        let currentGeneKeyNumber = 1;

        // CSVè§£æå‡½æ•¸ï¼ˆè™•ç†å¼•è™Ÿå’Œå¤šè¡Œï¼‰
        function parseCSV(text) {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let inQuotes = false;
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // é›™å¼•è™Ÿè½‰ç¾©
                        currentField += '"';
                        i++; // è·³éä¸‹ä¸€å€‹å¼•è™Ÿ
                    } else {
                        // åˆ‡æ›å¼•è™Ÿç‹€æ…‹
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    // å­—æ®µçµæŸ
                    currentRow.push(currentField.trim());
                    currentField = '';
                } else if ((char === '\n' || char === '\r') && !inQuotes) {
                    // è¡ŒçµæŸ
                    if (currentField || currentRow.length > 0) {
                        currentRow.push(currentField.trim());
                        currentField = '';
                        if (currentRow.some(f => f)) { // è‡³å°‘æœ‰ä¸€å€‹éç©ºå­—æ®µ
                            rows.push(currentRow);
                        }
                        currentRow = [];
                    }
                    // è™•ç† \r\n
                    if (char === '\r' && nextChar === '\n') {
                        i++;
                    }
                } else {
                    currentField += char;
                }
            }
            
            // è™•ç†æœ€å¾Œä¸€è¡Œ
            if (currentField || currentRow.length > 0) {
                currentRow.push(currentField.trim());
                if (currentRow.some(f => f)) {
                    rows.push(currentRow);
                }
            }
            
            return rows;
        }

        // è§£æCSVæ•¸æ“šï¼ˆæ”¹é€²ç‰ˆï¼Œè™•ç†å¤šè¡Œå­—æ®µï¼‰
        async function loadGeneKeysData() {
            try {
                const response = await fetch('åŸºå› å¤©å‘½.csv');
                const text = await response.text();
                
                // ä½¿ç”¨æ›´æ™ºèƒ½çš„CSVè§£æ
                const rows = parseCSV(text);
                
                // è·³éæ¨™é¡Œè¡Œï¼ˆç¬¬1è¡Œï¼Œç´¢å¼•0ï¼‰å’Œåˆ—åè¡Œï¼ˆç¬¬2è¡Œï¼Œç´¢å¼•1ï¼‰
                for (let i = 2; i < rows.length; i++) {
                    const row = rows[i];
                    if (!row || row.length < 9) continue;
                    
                    const name = row[0] || '';
                    const number = parseInt(name.replace('åŸºå› å¤©å‘½', ''));
                    
                    if (number >= 1 && number <= 64) {
                        geneKeysData[number] = {
                            name: name,
                            meaning: row[1] || '',
                            shadow: row[2] || '',
                            manifestation: row[3] || '',
                            gift: row[4] || '',
                            transformation: row[5] || '',
                            siddhi: row[6] || '',
                            finalState: row[7] || '',
                            synthesis: row[8] || ''
                        };
                    }
                }
                console.log('åŸºå› å¤©å‘½æ•¸æ“šå·²åŠ è¼‰:', Object.keys(geneKeysData).length, 'å€‹');
            } catch (error) {
                console.error('åŠ è¼‰åŸºå› å¤©å‘½æ•¸æ“šå¤±æ•—:', error);
            }
        }

        // é¡¯ç¤ºåŸºå› å¤©å‘½èªªæ˜é¢æ¿ï¼ˆå…¨å±€ä½œç”¨åŸŸï¼Œç¢ºä¿åœ¨ renderGeneKeys ä¹‹å‰å®šç¾©ï¼‰
        function showGeneKeyDetail(number, color = 'orange') {
            if (!geneKeysData[number]) {
                console.warn('æ‰¾ä¸åˆ°åŸºå› å¤©å‘½', number, 'çš„æ•¸æ“š');
                return;
            }

            currentGeneKeyNumber = number;
            const data = geneKeysData[number];
            const panel = document.getElementById('gene-key-detail-panel');
            
            if (!panel) {
                console.error('æ‰¾ä¸åˆ°èªªæ˜é¢æ¿å…ƒç´ ');
                return;
            }

            // æ›´æ–°æ¨™é¡Œå’Œå¾½ç« 
            const badge = document.getElementById('detail-badge');
            const badgeNumber = document.getElementById('detail-badge-number');
            badgeNumber.textContent = number;
            document.getElementById('detail-title').textContent = data.name;
            
            // æ ¹æ“šçƒé«”é¡è‰²æ›´æ–°å¾½ç« æ¨£å¼
            let badgeGradient = '';
            let badgeShadow = '';
            
            if (color === 'green') {
                // å•Ÿå‹•åºåˆ— - ç¶ è‰²
                badgeGradient = 'linear-gradient(135deg, #76a07b 0%, #2d4d32 100%)';
                badgeShadow = '0 4px 12px rgba(118, 160, 123, 0.3)';
            } else if (color === 'blue') {
                // çç åºåˆ— - å¯¶è—è‰²
                badgeGradient = 'linear-gradient(135deg, #3498db 0%, #21618c 100%)';
                badgeShadow = '0 4px 12px rgba(52, 152, 219, 0.3)';
            } else {
                // é‡‘æ˜Ÿåºåˆ— - æ·±ç´…/é…’ç´…è‰²ï¼ˆé»˜èªï¼‰
                badgeGradient = 'linear-gradient(135deg, #c0392b 0%, #8b2635 100%)';
                badgeShadow = '0 4px 12px rgba(192, 57, 43, 0.3)';
            }
            
            badge.style.background = badgeGradient;
            badge.style.boxShadow = badgeShadow;

            // æ›´æ–°å…§å®¹ï¼ˆæ‰€æœ‰åˆ†é¡ï¼‰
            const contentBody = document.getElementById('detail-content-body');
            contentBody.innerHTML = `
                <div class="detail-section active" data-tab="meaning">
                    <div class="detail-section-title">æ„ç¾©</div>
                    <div class="detail-section-content">${formatText(data.meaning)}</div>
                </div>
                <div class="detail-section" data-tab="shadow">
                    <div class="detail-section-title">é™°å½±</div>
                    <div class="detail-section-content">${formatText(data.shadow)}</div>
                </div>
                <div class="detail-section" data-tab="manifestation">
                    <div class="detail-section-title">è¡¨ç¾å½¢å¼</div>
                    <div class="detail-section-content">${formatText(data.manifestation)}</div>
                </div>
                <div class="detail-section" data-tab="gift">
                    <div class="detail-section-title">å¤©è³¦</div>
                    <div class="detail-section-content">${formatText(data.gift)}</div>
                </div>
                <div class="detail-section" data-tab="transformation">
                    <div class="detail-section-title">è½‰åŒ–éç¨‹</div>
                    <div class="detail-section-content">${formatText(data.transformation)}</div>
                </div>
                <div class="detail-section" data-tab="siddhi">
                    <div class="detail-section-title">ç¥è–æ‰èƒ½</div>
                    <div class="detail-section-content">${formatText(data.siddhi)}</div>
                </div>
                <div class="detail-section" data-tab="finalState">
                    <div class="detail-section-title">æœ€çµ‚ç‹€æ…‹</div>
                    <div class="detail-section-content">${formatText(data.finalState)}</div>
                </div>
                <div class="detail-section" data-tab="synthesis">
                    <div class="detail-section-title">ç¶œåˆæ„ç¾©</div>
                    <div class="detail-section-content">${formatText(data.synthesis)}</div>
                </div>
            `;

            // é‡ç½®æ¨™ç±¤é ç‹€æ…‹ï¼ˆé»˜èªé¡¯ç¤º"æ„ç¾©"ï¼‰
            switchTab('meaning');

            // é¡¯ç¤ºé¢æ¿
            panel.classList.remove('hidden');
        }

        // åˆ‡æ›æ¨™ç±¤é 
        function switchTab(tabName) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => {
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // æ›´æ–°å…§å®¹é¡¯ç¤º
            const sections = document.querySelectorAll('.detail-section');
            sections.forEach(section => {
                if (section.getAttribute('data-tab') === tabName) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
        }

        // åˆå§‹åŒ–èªªæ˜é¢æ¿äº‹ä»¶
        function initGeneKeyDetailPanel() {
            // é—œé–‰æŒ‰éˆ•
            const closeBtn = document.getElementById('detail-panel-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    document.getElementById('gene-key-detail-panel').classList.add('hidden');
                });
            }

            // é»æ“Šé®ç½©é—œé–‰
            const overlay = document.querySelector('.detail-panel-overlay');
            if (overlay) {
                overlay.addEventListener('click', () => {
                    document.getElementById('gene-key-detail-panel').classList.add('hidden');
                });
            }

            // æ¨™ç±¤é æŒ‰éˆ•äº‹ä»¶
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabName = btn.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            // éµç›¤å°èˆªï¼ˆåªä¿ç•™ESCé—œé–‰åŠŸèƒ½ï¼‰
            document.addEventListener('keydown', (e) => {
                const panel = document.getElementById('gene-key-detail-panel');
                if (panel && !panel.classList.contains('hidden')) {
                    if (e.key === 'Escape') {
                        panel.classList.add('hidden');
                    }
                }
            });
        }

        // æ ¼å¼åŒ–æ–‡æœ¬ï¼ˆè™•ç†æ›è¡Œå’Œåˆ—è¡¨ï¼‰
        function formatText(text) {
            if (!text) return '';
            
            // å°‡æ–‡æœ¬æŒ‰è¡Œåˆ†å‰²
            let lines = text.split(/\n/).filter(line => line.trim());
            let html = '';
            
            for (let line of lines) {
                line = line.trim();
                if (!line) continue;
                
                // æª¢æŸ¥æ˜¯å¦æ˜¯åˆ—è¡¨é …ï¼ˆä»¥æ•¸å­—é–‹é ­ï¼‰
                if (/^\d+\.\s/.test(line)) {
                    if (!html.includes('<ul>')) {
                        html += '<ul>';
                    }
                    const content = line.replace(/^\d+\.\s*/, '');
                    html += `<li>${escapeHtml(content)}</li>`;
                } else {
                    // å¦‚æœä¹‹å‰æœ‰åˆ—è¡¨ï¼Œå…ˆé—œé–‰
                    if (html.includes('<ul>') && !html.endsWith('</ul>')) {
                        html += '</ul>';
                    }
                    html += `<p>${escapeHtml(line)}</p>`;
                }
            }
            
            // é—œé–‰æœªé—œé–‰çš„åˆ—è¡¨
            if (html.includes('<ul>') && !html.endsWith('</ul>')) {
                html += '</ul>';
            }
            
            return html || `<p>${escapeHtml(text)}</p>`;
        }

        // HTMLè½‰ç¾©
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        
        // æ¸²æŸ“åŸºå› å¤©å‘½ (Gene Keys) é»ƒé‡‘ä¹‹è·¯ - é‡æ§‹ç‰ˆæœ¬
        function renderGeneKeys(personalityList, designList) {
            const container = document.getElementById('gene-keys-container');
            const section = document.getElementById('gene-keys-section');
            
            if (!container || !section) {
                console.error('æ‰¾ä¸åˆ°åŸºå› å¤©å‘½å®¹å™¨');
                return;
            }
            
            // å¾è¡Œæ˜Ÿåˆ—è¡¨ä¸­æå–é—œéµæ•¸æ“š
            function findPlanet(list, planetName) {
                return list.find(p => p.planet === planetName);
            }
            
            // ç²å–é—œéµè¡Œæ˜Ÿæ•¸æ“š
            const personalitySun = findPlanet(personalityList, 'Sun');
            const personalityEarth = findPlanet(personalityList, 'Earth');
            const designSun = findPlanet(designList, 'Sun');
            const designEarth = findPlanet(designList, 'Earth');
            const personalityMoon = findPlanet(personalityList, 'Moon');
            const designMoon = findPlanet(designList, 'Moon');
            const personalityVenus = findPlanet(personalityList, 'Venus');
            const designVenus = findPlanet(designList, 'Venus');
            const personalityMars = findPlanet(personalityList, 'Mars');
            const designMars = findPlanet(designList, 'Mars');
            const personalityJupiter = findPlanet(personalityList, 'Jupiter');
            const designJupiter = findPlanet(designList, 'Jupiter');
            
            // åŸºå› å¤©å‘½ç¯€é»å®šç¾©ï¼ˆ5x5 ç¶²æ ¼ç³»çµ±ï¼‰
            // æ ¼å¼: { id, label, value, color, gridRow, gridCol, description, sequence }
            // sequence: 'genius' (å¤©è³¦/ç¶ è‰²), 'love' (é—œä¿‚/ç´…è‰²), 'prosperity' (æœå‹™/è—è‰²)
            const geneKeyNodes = [
                // å‚ç›´ä¸­è»¸ (ç¬¬ 3 æ¬„)
                { id: 'personality-sun', label: 'é»‘å¤ªé™½', value: personalitySun?.gate_line || 'N/A', 
                  color: 'green', gridRow: 1, gridCol: 3, description: 'Life\'s Work', planet: 'Sun', type: 'personality', sequence: 'genius', sequences: ['genius', 'prosperity'], prosperityColor: 'blue' },
                { id: 'personality-jupiter', label: 'é»‘æœ¨æ˜Ÿ', value: personalityJupiter?.gate_line || 'N/A', 
                  color: 'blue', gridRow: 2, gridCol: 3, description: 'Pearl', planet: 'Jupiter', type: 'personality', sequence: 'prosperity' },
                { id: 'design-venus', label: 'ç´…é‡‘æ˜Ÿ', value: designVenus?.gate_line || 'N/A', 
                  color: 'orange', gridRow: 3, gridCol: 3, description: 'SQ', planet: 'Venus', type: 'design', sequence: 'love' },
                { id: 'design-moon', label: 'ç´…æœˆäº®', value: designMoon?.gate_line || 'N/A', 
                  color: 'orange', gridRow: 4, gridCol: 3, description: 'Attraction', planet: 'Moon', type: 'design', sequence: 'love' },
                { id: 'design-earth', label: 'ç´…åœ°çƒ', value: designEarth?.gate_line || 'N/A', 
                  color: 'green', gridRow: 5, gridCol: 3, description: 'Purpose', planet: 'Earth', type: 'design', sequence: 'genius', sequences: ['genius', 'love'], loveColor: 'orange' },
                
                // ä¸­å±¤å…©å´ (ç¬¬ 2, 4 æ¬„)
                { id: 'design-mars', label: 'ç´…ç«æ˜Ÿ', value: designMars?.gate_line || 'N/A', 
                  color: 'blue', gridRow: 2, gridCol: 2, description: 'Core', planet: 'Mars', type: 'design', transform: 'translate(20px, 60px)', sequence: 'prosperity', sequences: ['prosperity', 'love'], loveColor: 'orange' },
                { id: 'design-jupiter', label: 'ç´…æœ¨æ˜Ÿ', value: designJupiter?.gate_line || 'N/A', 
                  color: 'blue', gridRow: 2, gridCol: 4, description: 'Culture', planet: 'Jupiter', type: 'design', transform: 'translate(-20px, 60px)', sequence: 'prosperity' },
                { id: 'design-sun', label: 'ç´…å¤ªé™½', value: designSun?.gate_line || 'N/A', 
                  color: 'green', gridRow: 3, gridCol: 1, description: 'Radiance', planet: 'Sun', type: 'design', sequence: 'genius' },
                { id: 'personality-earth', label: 'é»‘åœ°çƒ', value: personalityEarth?.gate_line || 'N/A', 
                  color: 'green', gridRow: 3, gridCol: 5, description: 'Evolution', planet: 'Earth', type: 'personality', sequence: 'genius' },
                { id: 'personality-venus', label: 'é»‘é‡‘æ˜Ÿ', value: personalityVenus?.gate_line || 'N/A', 
                  color: 'orange', gridRow: 4, gridCol: 2, description: 'IQ', planet: 'Venus', type: 'personality', transform: 'translate(0, -70px)', sequence: 'love' },
                { id: 'personality-mars', label: 'é»‘ç«æ˜Ÿ', value: personalityMars?.gate_line || 'N/A', 
                  color: 'orange', gridRow: 4, gridCol: 4, description: 'EQ', planet: 'Mars', type: 'personality', transform: 'translate(0, -70px)', sequence: 'love' },
            ];
            
            // æ§‹å»ºé€£æ¥ç·šæ•¸æ“šï¼ˆæ ¹æ“šæŒ‡å®šçš„ä¸‰æ¢åºåˆ—è·¯å¾‘ï¼‰
            // sequence: 'genius' (å¤©è³¦/ç¶ è‰²), 'love' (é—œä¿‚/ç´…è‰²), 'prosperity' (æœå‹™/è—è‰²)
            const connections = [
                // 1. å•Ÿå‹•åºåˆ— (Activation Sequence) - ç¶ è‰²é€£ç·š = å¤©è³¦ (genius)
                { from: 'design-sun', to: 'design-earth', color: 'green', sequence: 'genius' },        // ç´…å¤ªé™½ â†’ ç´…åœ°çƒ
                { from: 'personality-sun', to: 'personality-earth', color: 'green', sequence: 'genius' }, // é»‘å¤ªé™½ â†’ é»‘åœ°çƒ
                { from: 'personality-earth', to: 'design-sun', color: 'green', sequence: 'genius' },   // é»‘åœ°çƒ â†’ ç´…å¤ªé™½
                { from: 'design-sun', to: 'personality-earth', color: 'green', sequence: 'genius' },   // ç´…å¤ªé™½ â†’ é»‘åœ°çƒ
                
                // 2. é‡‘æ˜Ÿåºåˆ— (Venus Sequence) - ç´…è‰²é€£ç·š = é—œä¿‚ (love)
                { from: 'personality-venus', to: 'personality-mars', color: 'red', sequence: 'love' }, // é»‘é‡‘æ˜Ÿ â†’ é»‘ç«æ˜Ÿ
                { from: 'personality-venus', to: 'design-moon', color: 'red', sequence: 'love' },      // é»‘é‡‘æ˜Ÿ â†’ ç´…æœˆäº®
                { from: 'design-moon', to: 'design-earth', color: 'red', sequence: 'love' },          // ç´…æœˆäº® â†’ ç´…åœ°çƒ
                { from: 'design-earth', to: 'design-moon', color: 'red', sequence: 'love' },          // ç´…åœ°çƒ â†’ ç´…æœˆäº®
                { from: 'design-venus', to: 'personality-mars', color: 'red', sequence: 'love' },    // ç´…é‡‘æ˜Ÿ â†’ é»‘ç«æ˜Ÿ
                { from: 'design-mars', to: 'design-venus', color: 'red', sequence: 'love' },          // ç´…ç«æ˜Ÿ â†’ ç´…é‡‘æ˜Ÿ
                
                // 3. çç åºåˆ— (Pearl Sequence) - è—è‰²é€£ç·š = æœå‹™ (prosperity)
                // ç§»é™¤ï¼šç´…é‡‘æ˜Ÿ â†’ ç´…æœ¨æ˜Ÿ çš„é€£ç·š
                { from: 'design-jupiter', to: 'personality-jupiter', color: 'blue', sequence: 'prosperity' }, // ç´…æœ¨æ˜Ÿ â†’ é»‘æœ¨æ˜Ÿ
                { from: 'personality-jupiter', to: 'design-mars', color: 'blue', sequence: 'prosperity' }, // é»‘æœ¨æ˜Ÿ â†’ ç´…ç«æ˜Ÿ
                // ç§»é™¤ï¼šç´…ç«æ˜Ÿ â†’ ç´…é‡‘æ˜Ÿ å’Œ ç´…æœ¨æ˜Ÿ â†’ ç´…é‡‘æ˜Ÿ çš„é€£ç·š
                { from: 'design-mars', to: 'design-jupiter', color: 'blue', sequence: 'prosperity' },      // ç´…ç«æ˜Ÿ â†’ ç´…æœ¨æ˜Ÿ
                { from: 'personality-sun', to: 'design-mars', color: 'blue', sequence: 'prosperity' },     // é»‘å¤ªé™½ â†’ ç´…ç«æ˜Ÿ
                { from: 'personality-sun', to: 'design-jupiter', color: 'blue', sequence: 'prosperity' },  // é»‘å¤ªé™½ â†’ ç´…æœ¨æ˜Ÿ
                { from: 'personality-jupiter', to: 'personality-sun', color: 'blue', sequence: 'prosperity' }, // é»‘æœ¨æ˜Ÿ â†’ é»‘å¤ªé™½
            ];
            
            // å‰µå»ºå®¹å™¨ï¼ˆä½¿ç”¨ 5x5 ç¶²æ ¼ï¼‰
            const wrapper = document.createElement('div');
            wrapper.className = 'gene-keys-wrapper';
            
            // å‰µå»º SVG å±¤ï¼ˆæœ€åº•å±¤ï¼‰
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('class', 'gene-keys-svg');
            svg.setAttribute('width', '900');
            svg.setAttribute('height', '900');
            svg.setAttribute('viewBox', '0 0 900 900');
            
            // è¨ˆç®—æ¯å€‹ç¶²æ ¼å–®å…ƒçš„ä¸­å¿ƒé»ï¼ˆè€ƒæ…® gap å’Œ paddingï¼‰
            // ç¸½å°ºå¯¸: 900px, padding: 60px (å…©é‚Š), gap: 100px (4å€‹)
            // å–®å…ƒæ ¼å¯¬åº¦ = (900 - 2*60 - 4*100) / 5 = 76px
            const getCenterPoint = (gridRow, gridCol) => {
                const padding = 60;
                const gap = 100;
                const cellSize = (900 - 2 * padding - 4 * gap) / 5; // 76px
                
                // è¨ˆç®—ä¸­å¿ƒé»ï¼špadding + (col-1)*(cell+gap) + cell/2
                const x = padding + (gridCol - 1) * (cellSize + gap) + cellSize / 2;
                const y = padding + (gridRow - 1) * (cellSize + gap) + cellSize / 2;
                
                return { x, y };
            };
            
            // å‰µå»ºç¯€é»ä¸¦è¨˜éŒ„ä½ç½®
            const nodePositions = {};
            
            geneKeyNodes.forEach(node => {
                // å‰µå»ºç¯€é»å…ƒç´ 
                const nodeEl = document.createElement('div');
                nodeEl.className = `gene-key-sphere ${node.color}`;
                nodeEl.id = `gene-key-${node.id}`;
                
                // è¨­ç½®åºåˆ—å±¬æ€§ï¼ˆç”¨æ–¼éæ¿¾ï¼‰
                // æ”¯æŒå¤šå€‹åºåˆ—ï¼ˆsequences æ•¸çµ„ï¼‰æˆ–å–®å€‹åºåˆ—ï¼ˆsequenceï¼‰
                if (node.sequences && Array.isArray(node.sequences)) {
                    nodeEl.setAttribute('data-sequences', node.sequences.join(','));
                    // ä¹Ÿè¨­ç½®ä¸»è¦åºåˆ—ï¼ˆç”¨æ–¼å‘å¾Œå…¼å®¹ï¼‰
                    nodeEl.setAttribute('data-sequence', node.sequence || node.sequences[0]);
                } else if (node.sequence) {
                    nodeEl.setAttribute('data-sequence', node.sequence);
                }
                
                // å¦‚æœç¯€é»æœ‰ loveColor å±¬æ€§ï¼Œä¿å­˜åŸå§‹é¡è‰²å’Œé—œä¿‚æ¨¡å¼é¡è‰²
                if (node.loveColor) {
                    nodeEl.setAttribute('data-original-color', node.color);
                    nodeEl.setAttribute('data-love-color', node.loveColor);
                }
                
                // å¦‚æœç¯€é»æœ‰ prosperityColor å±¬æ€§ï¼Œä¿å­˜åŸå§‹é¡è‰²å’Œæœå‹™æ¨¡å¼é¡è‰²
                if (node.prosperityColor) {
                    // å¦‚æœå·²ç¶“æœ‰ data-original-colorï¼Œä¸è¦è¦†è“‹ï¼ˆå› ç‚ºå¯èƒ½åŒæ™‚æœ‰ loveColorï¼‰
                    if (!nodeEl.getAttribute('data-original-color')) {
                        nodeEl.setAttribute('data-original-color', node.color);
                    }
                    nodeEl.setAttribute('data-prosperity-color', node.prosperityColor);
                }
                
                // è¨­ç½®ç¶²æ ¼ä½ç½®
                nodeEl.style.gridRow = node.gridRow;
                nodeEl.style.gridColumn = node.gridCol;
                
                // å¦‚æœæœ‰ transform å±¬æ€§ï¼Œæ‡‰ç”¨å®ƒ
                if (node.transform) {
                    nodeEl.setAttribute('data-transform', node.transform);
                    nodeEl.style.transform = node.transform;
                    // ç‚ºäº† hover æ•ˆæœï¼Œä½¿ç”¨ CSS è®Šé‡ä¿å­˜åŸå§‹ transform + scale
                    // ç¢ºä¿ hover æ™‚èƒ½æ­£ç¢ºæ”¾å¤§
                    const hoverTransform = node.transform + ' scale(1.15)';
                    nodeEl.style.setProperty('--original-transform', hoverTransform);
                }
                
                // è§£æé–˜é–€å’Œçˆ»ç·š
                const gateLine = node.value.toString();
                const parts = gateLine.split('.');
                const gate = parts[0] || '';
                const line = parts[1] || '';
                
                // ç²å–æ˜Ÿåº§ç¬¦è™Ÿï¼ˆå¾åŸå§‹è¡Œæ˜Ÿæ•¸æ“šï¼‰
                let zodiac = '';
                const planetData = findPlanet(node.type === 'personality' ? personalityList : designList, node.planet);
                if (planetData && planetData.constellation_symbol) {
                    zodiac = planetData.constellation_symbol;
                }
                
                // ä½¿ç”¨èˆ‡åœ“å½¢åœ–è¡¨ç›¸åŒçš„æ ¼å¼é¡¯ç¤º
                nodeEl.innerHTML = `
                    <div class="planet-marker-name">${node.label}</div>
                    <div class="planet-marker-house"></div>
                    <div class="planet-marker-gate">${gate}</div>
                    <div class="planet-marker-line">${line}çˆ»</div>
                    <div class="planet-marker-zodiac">${zodiac}</div>
                `;
                
                wrapper.appendChild(nodeEl);
                
                // æ·»åŠ é»æ“Šäº‹ä»¶ï¼šé¡¯ç¤ºåŸºå› å¤©å‘½èªªæ˜
                nodeEl.addEventListener('click', function() {
                    const gateNumber = parseInt(gate);
                    if (gateNumber && gateNumber >= 1 && gateNumber <= 64) {
                        // ç²å–çƒé«”çš„é¡è‰²ï¼ˆå¾ className ä¸­æå–ï¼‰
                        let sphereColor = 'orange'; // é»˜èªé¡è‰²
                        if (nodeEl.classList.contains('green')) {
                            sphereColor = 'green';
                        } else if (nodeEl.classList.contains('blue')) {
                            sphereColor = 'blue';
                        } else if (nodeEl.classList.contains('orange')) {
                            sphereColor = 'orange';
                        }
                        showGeneKeyDetail(gateNumber, sphereColor);
                    }
                });
                
                // è¨˜éŒ„ç¯€é»ä¸­å¿ƒä½ç½®
                const center = getCenterPoint(node.gridRow, node.gridCol);
                nodePositions[node.id] = center;
            });
            
            // è¼”åŠ©å‡½æ•¸ï¼šç²å–é€£æ¥ç·šé¡è‰²
            function getConnectionColor(colorType) {
                switch(colorType) {
                    case 'blue': return '#3498db';  // çç åºåˆ— - è—è‰²
                    case 'green': return '#76a07b';  // å•Ÿå‹•åºåˆ— - ç¶ è‰²ï¼ˆèˆ‡çƒé«”é¡è‰²ä¸€è‡´ï¼‰
                    case 'red': return '#c0392b';    // é‡‘æ˜Ÿåºåˆ— - ç´…è‰²
                    default: return '#999';
                }
            }
            
            // ç¹ªè£½ SVG é€£æ¥ç·šçš„å‡½æ•¸
            function drawGeneKeyLines() {
                // æ¸…é™¤ä¹‹å‰çš„é€£ç·š
                svg.innerHTML = '';
                
                // ç²å– containerWrapper å…ƒç´ ï¼ˆé€šéæŸ¥æ‰¾åŒ…å« SVG çš„çˆ¶å…ƒç´ ï¼‰
                const svgParent = svg.parentElement;
                if (!svgParent) {
                    console.warn('æ‰¾ä¸åˆ° SVG çš„çˆ¶å…ƒç´ ');
                    return;
                }
                
                // ç²å– SVG çš„å¯¦éš›ä½ç½®ï¼ˆè€ƒæ…®æ»¾å‹•å’Œè®Šæ›ï¼‰
                const svgRect = svg.getBoundingClientRect();
                const containerWrapperRect = svgParent.getBoundingClientRect();
                
                // é‡æ–°è¨ˆç®—æ‰€æœ‰ç¯€é»çš„å¯¦éš›ä¸­å¿ƒä½ç½®ï¼ˆåŸºæ–¼ DOM å…ƒç´ ï¼‰
                const actualPositions = {};
                geneKeyNodes.forEach(node => {
                    const nodeEl = document.getElementById(`gene-key-${node.id}`);
                    if (nodeEl && svgParent) {
                        const nodeRect = nodeEl.getBoundingClientRect();
                        // è¨ˆç®—ç›¸å°æ–¼ SVG çš„åº§æ¨™ï¼ˆçƒé«”åœ“å¿ƒï¼‰
                        // ä½¿ç”¨ SVG çš„å¯¦éš›ä½ç½®ä½œç‚ºåƒè€ƒï¼Œç¢ºä¿æ‰‹æ©Ÿç‰ˆæ»¾å‹•æ™‚ä½ç½®æ­£ç¢º
                        const relativeX = nodeRect.left - svgRect.left + nodeRect.width / 2;
                        const relativeY = nodeRect.top - svgRect.top + nodeRect.height / 2;
                        
                        actualPositions[node.id] = {
                            x: relativeX,
                            y: relativeY
                        };
                    } else {
                        // å¦‚æœ DOM é‚„æ²’æ¸²æŸ“ï¼Œä½¿ç”¨è¨ˆç®—çš„åº§æ¨™
                        actualPositions[node.id] = nodePositions[node.id];
                    }
                });
                
                // ç¹ªè£½ SVG é€£æ¥ç·šï¼ˆä½¿ç”¨ path å…ƒç´ ï¼‰
                connections.forEach(conn => {
                    const fromPos = actualPositions[conn.from] || nodePositions[conn.from];
                    const toPos = actualPositions[conn.to] || nodePositions[conn.to];
                    
                    if (!fromPos || !toPos) {
                        console.warn(`æ‰¾ä¸åˆ°ç¯€é»ä½ç½®: ${conn.from} -> ${conn.to}`);
                        return;
                    }
                    
                    // å‰µå»º SVG path å…ƒç´ 
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    
                    // ä½¿ç”¨ç°¡å–®çš„ç›´ç·šé€£æ¥çƒé«”åœ“å¿ƒ
                    const d = `M ${fromPos.x} ${fromPos.y} L ${toPos.x} ${toPos.y}`;
                    path.setAttribute('d', d);
                    path.setAttribute('class', `gene-key-path gene-key-path-${conn.color}`);
                    
                    // è¨­ç½®åºåˆ—å±¬æ€§ï¼ˆç”¨æ–¼éæ¿¾ï¼‰
                    if (conn.sequence) {
                        path.setAttribute('data-sequence', conn.sequence);
                    }
                    
                    path.setAttribute('stroke', getConnectionColor(conn.color));
                    path.setAttribute('stroke-width', '4');
                    path.setAttribute('stroke-opacity', '0.5');
                    path.setAttribute('fill', 'none');
                    
                    svg.appendChild(path);
                });
                
                console.log('å·²ç¹ªè£½', connections.length, 'æ¢é€£æ¥ç·š');
            }
            
            // å°‡ SVG å’Œ wrapper æ”¾å…¥å®¹å™¨
            const containerWrapper = document.createElement('div');
            containerWrapper.style.position = 'relative';
            containerWrapper.className = 'gene-keys-container-wrapper';
            
            // å°ºå¯¸ç”± CSS æ§åˆ¶ï¼Œæ‰‹æ©Ÿç‰ˆæœƒè‡ªå‹•èª¿æ•´
            // ä¸è¨­ç½® inline styleï¼Œè®“ CSS çš„ !important è¦å‰‡ç”Ÿæ•ˆ
            if (window.innerWidth > 768) {
                containerWrapper.style.width = '900px';
                containerWrapper.style.height = '900px';
                containerWrapper.style.margin = '0 auto';
            }
            // æ‰‹æ©Ÿç‰ˆå®Œå…¨ç”± CSS æ§åˆ¶
            
            // å…ˆæ·»åŠ  SVGï¼ˆåº•å±¤ï¼‰
            containerWrapper.appendChild(svg);
            // å†æ·»åŠ  wrapperï¼ˆä¸Šå±¤ï¼‰
            containerWrapper.appendChild(wrapper);
            
            container.innerHTML = '';
            container.appendChild(containerWrapper);
            section.style.display = 'block';
            
            // åœ¨æ‰€æœ‰ç¯€é»æ¸²æŸ“å®Œæˆå¾Œç¹ªè£½é€£ç·šï¼ˆå»¶é²æ›´é•·ä»¥ç¢ºä¿ DOM å®Œå…¨æ¸²æŸ“ï¼‰
            setTimeout(() => {
                drawGeneKeyLines();
            }, 200);

            // ç›£è½è¦–çª—å¤§å°è®ŠåŒ–å’Œæ»¾å‹•äº‹ä»¶ï¼Œé‡æ–°ç¹ªè£½é€£ç·š
            let resizeTimeout;
            let scrollTimeout;
            
            const handleResize = () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    // é‡æ–°ç¹ªè£½é€£ç·šï¼ˆå°ºå¯¸å§‹çµ‚æ˜¯ 900pxï¼Œä¸éœ€è¦èª¿æ•´ï¼‰
                    drawGeneKeyLines();
                    console.log('è¦–çª—å¤§å°æ”¹è®Šï¼Œé‡æ–°ç¹ªè£½é€£ç·š');
                }, 200);
            };
            
            // ç›£è½æ»¾å‹•äº‹ä»¶ï¼ˆæ‰‹æ©Ÿç‰ˆéœ€è¦ï¼‰
            const handleScroll = () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    // æ‰‹æ©Ÿç‰ˆæ»¾å‹•æ™‚é‡æ–°è¨ˆç®—é€£ç·šä½ç½®
                    if (window.innerWidth <= 768) {
                        drawGeneKeyLines();
                    }
                }, 100);
            };

            // æ·»åŠ  resize äº‹ä»¶ç›£è½å™¨
            window.addEventListener('resize', handleResize);

            // ç›£è½è¢å¹•æ–¹å‘è®ŠåŒ–ï¼ˆæ‰‹æ©Ÿæ—‹è½‰ï¼‰
            window.addEventListener('orientationchange', () => {
                setTimeout(handleResize, 300);
            });
            
            // ç›£è½æ»¾å‹•äº‹ä»¶ï¼ˆæ‰‹æ©Ÿç‰ˆéœ€è¦ï¼Œç¢ºä¿ç·šæ¢ä½ç½®æ­£ç¢ºï¼‰
            const geneKeysContainer = document.getElementById('gene-keys-container');
            if (geneKeysContainer) {
                geneKeysContainer.addEventListener('scroll', handleScroll, { passive: true });
            }
            
            // ä¹Ÿç›£è½æ•´å€‹è¦–çª—çš„æ»¾å‹•ï¼ˆä»¥é˜²è¬ä¸€ï¼‰
            window.addEventListener('scroll', handleScroll, { passive: true });

            // ç›£è½ç¸®æ”¾äº‹ä»¶ï¼ˆç•¶ç”¨æˆ¶ç¸®æ”¾æ™‚é‡æ–°ç¹ªè£½é€£ç·šï¼‰
            let lastZoomLevel = window.devicePixelRatio || 1;
            const checkZoom = () => {
                const currentZoom = window.devicePixelRatio || 1;
                if (Math.abs(currentZoom - lastZoomLevel) > 0.1) {
                    lastZoomLevel = currentZoom;
                    drawGeneKeyLines();
                    console.log('æª¢æ¸¬åˆ°ç¸®æ”¾è®ŠåŒ–ï¼Œé‡æ–°ç¹ªè£½é€£ç·š');
                }
            };
            
            // ä½¿ç”¨è¦–è¦ºè¦–å£ API ç›£è½ç¸®æ”¾ï¼ˆå¦‚æœæ”¯æ´ï¼‰
            if (window.visualViewport) {
                window.visualViewport.addEventListener('resize', () => {
                    setTimeout(() => {
                        drawGeneKeyLines();
                        checkZoom();
                    }, 100);
                });
            }
            
            // å®šæœŸæª¢æŸ¥ç¸®æ”¾è®ŠåŒ–ï¼ˆå‚™ç”¨æ–¹æ¡ˆï¼‰
            setInterval(checkZoom, 500);

            // å°‡ drawGeneKeyLines æš´éœ²çµ¦å…¨åŸŸï¼Œä»¥ä¾¿å…¶ä»–åœ°æ–¹å¯ä»¥èª¿ç”¨
            window.redrawGeneKeyLines = drawGeneKeyLines;

            // ==================== éæ¿¾åŠŸèƒ½ ====================
            
            // éæ¿¾å‡½æ•¸ï¼šæ ¹æ“šé¸æ“‡çš„åºåˆ—é¡¯ç¤º/éš±è—çƒé«”å’Œé€£ç·š
            function filterGeneKeys(sequence) {
                // ç²å–æ‰€æœ‰çƒé«”å’Œé€£ç·š
                const allSpheres = document.querySelectorAll('.gene-key-sphere');
                const allPaths = document.querySelectorAll('.gene-key-path');
                
                allSpheres.forEach(sphere => {
                    // æª¢æŸ¥æ˜¯å¦å±¬æ–¼ç•¶å‰åºåˆ—
                    let shouldShow = false;
                    
                    if (sequence === 'all') {
                        shouldShow = true;
                        // åœ¨ã€Œå…¨éƒ¨ã€æ¨¡å¼æ™‚ï¼Œæ¢å¾©æ‰€æœ‰çƒé«”çš„åŸå§‹é¡è‰²
                        const originalColor = sphere.getAttribute('data-original-color');
                        const loveColor = sphere.getAttribute('data-love-color');
                        const prosperityColor = sphere.getAttribute('data-prosperity-color');
                        if (originalColor) {
                            if (loveColor) {
                                sphere.classList.remove(loveColor);
                            }
                            if (prosperityColor) {
                                sphere.classList.remove(prosperityColor);
                            }
                            sphere.classList.add(originalColor);
                        }
                    } else {
                        // æª¢æŸ¥å–®å€‹åºåˆ—
                        const sphereSequence = sphere.getAttribute('data-sequence');
                        if (sphereSequence === sequence) {
                            shouldShow = true;
                        } else {
                            // æª¢æŸ¥å¤šå€‹åºåˆ—ï¼ˆdata-sequences å±¬æ€§ï¼‰
                            const sphereSequences = sphere.getAttribute('data-sequences');
                            if (sphereSequences) {
                                const sequencesArray = sphereSequences.split(',');
                                if (sequencesArray.includes(sequence)) {
                                    shouldShow = true;
                                }
                            }
                        }
                    }
                    
                    if (shouldShow) {
                        sphere.classList.remove('hidden', 'filtered-out');
                        sphere.style.opacity = '1';
                        sphere.style.pointerEvents = 'auto';
                        
                        // æ ¹æ“šæ¨¡å¼åˆ‡æ›é¡è‰²
                        const originalColor = sphere.getAttribute('data-original-color');
                        const loveColor = sphere.getAttribute('data-love-color');
                        const prosperityColor = sphere.getAttribute('data-prosperity-color');
                        
                        if (sequence === 'love') {
                            // ã€Œé—œä¿‚ã€æ¨¡å¼ï¼šä½¿ç”¨ loveColor
                            if (loveColor) {
                                if (originalColor) {
                                    sphere.classList.remove(originalColor);
                                }
                                if (prosperityColor) {
                                    sphere.classList.remove(prosperityColor);
                                }
                                sphere.classList.add(loveColor);
                            }
                        } else if (sequence === 'prosperity') {
                            // ã€Œæœå‹™ã€æ¨¡å¼ï¼šä½¿ç”¨ prosperityColor
                            if (prosperityColor) {
                                if (originalColor) {
                                    sphere.classList.remove(originalColor);
                                }
                                if (loveColor) {
                                    sphere.classList.remove(loveColor);
                                }
                                sphere.classList.add(prosperityColor);
                            } else if (loveColor) {
                                // å¦‚æœæ²’æœ‰ prosperityColor ä½†æœ‰ loveColorï¼Œæ¢å¾©åŸå§‹é¡è‰²
                                sphere.classList.remove(loveColor);
                                if (originalColor) {
                                    sphere.classList.add(originalColor);
                                }
                            }
                        } else {
                            // å…¶ä»–æ¨¡å¼ï¼ˆå¤©è³¦ï¼‰ï¼Œæ¢å¾©åŸå§‹é¡è‰²
                            if (loveColor) {
                                sphere.classList.remove(loveColor);
                            }
                            if (prosperityColor) {
                                sphere.classList.remove(prosperityColor);
                            }
                            if (originalColor) {
                                sphere.classList.add(originalColor);
                            }
                        }
                    } else {
                        sphere.classList.add('filtered-out');
                        sphere.style.opacity = '0.2';
                        sphere.style.pointerEvents = 'none';
                    }
                });
                
                allPaths.forEach(path => {
                    const pathSequence = path.getAttribute('data-sequence');
                    
                    if (sequence === 'all') {
                        // é¡¯ç¤ºæ‰€æœ‰é€£ç·š
                        path.classList.remove('hidden', 'filtered-out');
                        path.style.opacity = '0.5';
                    } else {
                        // åªé¡¯ç¤ºåŒ¹é…åºåˆ—çš„é€£ç·š
                        if (pathSequence === sequence) {
                            path.classList.remove('hidden', 'filtered-out');
                            path.style.opacity = '0.5';
                        } else {
                            path.classList.add('filtered-out');
                            path.style.opacity = '0.1';
                        }
                    }
                });
            }

            // ç‚ºéæ¿¾æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active é¡
                    filterButtons.forEach(b => b.classList.remove('active'));
                    
                    // æ·»åŠ  active é¡åˆ°ç•¶å‰æŒ‰éˆ•
                    this.classList.add('active');
                    
                    // ç²å–éæ¿¾é¡å‹
                    const filterType = this.getAttribute('data-filter');
                    
                    // åŸ·è¡Œéæ¿¾
                    filterGeneKeys(filterType);
                    
                    console.log('éæ¿¾é¡å‹:', filterType);
                });
            });

            // å°‡éæ¿¾å‡½æ•¸æš´éœ²åˆ°å…¨åŸŸ
            window.filterGeneKeys = filterGeneKeys;
        }

        // å°‡æ­·å²è¨˜éŒ„å‡½æ•¸æš´éœ²åˆ°å…¨åŸŸ
        window.loadHistoryRecord = loadHistoryRecord;
        window.deleteHistoryRecord = deleteHistoryRecord;

        // æ¸²æŸ“æ–‡å­—çµæœï¼ˆå·²ç§»é™¤ï¼‰

        // æ¸²æŸ“è¡Œæ˜Ÿåˆ—è¡¨åˆ°å´é‚Šæ¬„
        function renderPlanetLists(personalityList, designList) {
            // è¡Œæ˜Ÿ Unicode åœ–æ¨™æ˜ å°„
            const planetIcons = {
                'Sun': 'â˜‰',
                'Earth': 'âŠ•',
                'Moon': 'â˜½',
                'North Node': 'â˜Š',
                'South Node': 'â˜‹',
                'Mercury': 'â˜¿',
                'Venus': 'â™€',
                'Mars': 'â™‚',
                'Jupiter': 'â™ƒ',
                'Saturn': 'â™„',
                'Uranus': 'â™…',
                'Neptune': 'â™†',
                'Pluto': 'â™‡'
            };
            
            // è¡Œæ˜Ÿåç¨±ä¸­æ–‡æ˜ å°„ï¼ˆä¿ç•™ä½œç‚ºå‚™ç”¨ï¼‰
            const planetNames = {
                'Sun': 'å¤ªé™½',
                'Earth': 'åœ°çƒ',
                'Moon': 'æœˆäº®',
                'North Node': 'åŒ—äº¤',
                'South Node': 'å—äº¤',
                'Mercury': 'æ°´æ˜Ÿ',
                'Venus': 'é‡‘æ˜Ÿ',
                'Mars': 'ç«æ˜Ÿ',
                'Jupiter': 'æœ¨æ˜Ÿ',
                'Saturn': 'åœŸæ˜Ÿ',
                'Uranus': 'å¤©ç‹æ˜Ÿ',
                'Neptune': 'æµ·ç‹æ˜Ÿ',
                'Pluto': 'å†¥ç‹æ˜Ÿ'
            };

            // è¼”åŠ©å‡½æ•¸ï¼šæ ¼å¼åŒ–é–˜é–€.çˆ»ç·šé¡¯ç¤ºï¼ˆåˆ†é–‹é¡¯ç¤ºï¼Œçˆ»ç·šè¼ƒå°ï¼Œä¸¦åŒ…å«æ˜Ÿåº§ç¬¦è™Ÿå’Œç®­é ­ï¼‰
            function formatGateLine(planet, showArrow = true) {
                if (!planet.gate_line) return '';
                const parts = planet.gate_line.toString().split('.');
                if (parts.length === 2) {
                    const gate = parts[0];
                    const line = parts[1];
                    const zodiac = planet.constellation_symbol || '';
                    const arrow = (showArrow && planet.arrow_direction) || '';
                    
                    // ç®­é ­é¡è‰²ï¼šâ–²ç¶ è‰²ï¼Œâ–¼ç´…è‰²
                    let arrowHtml = '';
                    if (arrow === 'â–²') {
                        arrowHtml = `<span class="arrow-ascending" title="é †è¡Œé«˜é »">â–²</span>`;
                    } else if (arrow === 'â–¼') {
                        arrowHtml = `<span class="arrow-descending" title="é€†è¡Œ">â–¼</span>`;
                    }
                    
                    return `
                        ${zodiac ? `<span class="zodiac-symbol">${zodiac}</span>` : ''}
                        <span class="gate-number">${gate}</span>
                        <span class="gate-separator">.</span>
                        <span class="line-number">${line}</span>
                        ${arrowHtml}
                    `;
                }
                // å¦‚æœæ ¼å¼ä¸æ­£ç¢ºï¼Œè¿”å›åŸå§‹å€¼
                return `<span class="gate-number">${planet.gate_line}</span>`;
            }

            // æ¸²æŸ“è¨­è¨ˆå±¤ï¼ˆDesign/å·¦å´ï¼‰- ä½¿ç”¨ design_list
            const designContainer = document.getElementById('design-planet-list');
            if (designContainer && designList && Array.isArray(designList)) {
                let html = '';
                designList.forEach(planet => {
                    const planetName = planetNames[planet.planet] || planet.planet;
                    const planetIcon = planetIcons[planet.planet] || planet.planet.charAt(0);
                    const gateLineHtml = formatGateLine(planet, true);
                    html += `
                        <div class="planet-item">
                            <div class="planet-icon">${planetIcon}</div>
                            <div class="planet-name">${planetName}</div>
                            <div class="planet-gate-line">${gateLineHtml}</div>
                        </div>
                    `;
                });
                designContainer.innerHTML = html || '<div style="text-align: center; padding: 20px; color: #666;">ç„¡æ•¸æ“š</div>';
            } else if (designContainer) {
                designContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">ç­‰å¾…æ•¸æ“š...</div>';
            }

            // æ¸²æŸ“æ„è­˜å±¤ï¼ˆPersonality/å³å´ï¼‰- ä½¿ç”¨ personality_list
            const personalityContainer = document.getElementById('personality-planet-list');
            if (personalityContainer && personalityList && Array.isArray(personalityList)) {
                let html = '';
                personalityList.forEach(planet => {
                    const planetName = planetNames[planet.planet] || planet.planet;
                    const planetIcon = planetIcons[planet.planet] || planet.planet.charAt(0);
                    const gateLineHtml = formatGateLine(planet, true);
                    html += `
                        <div class="planet-item">
                            <div class="planet-icon">${planetIcon}</div>
                            <div class="planet-name">${planetName}</div>
                            <div class="planet-gate-line">${gateLineHtml}</div>
                        </div>
                    `;
                });
                personalityContainer.innerHTML = html || '<div style="text-align: center; padding: 20px; color: #666;">ç„¡æ•¸æ“š</div>';
            } else if (personalityContainer) {
                personalityContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">ç­‰å¾…æ•¸æ“š...</div>';
            }
        }

        // ==================== æ­·å²è¨˜éŒ„ç®¡ç† ====================
        
        // ç²å–æ‰€æœ‰æ­·å²è¨˜éŒ„
        function getHistoryRecords() {
            try {
                const records = localStorage.getItem('humanDesignHistory');
                return records ? JSON.parse(records) : [];
            } catch (e) {
                console.error('è®€å–æ­·å²è¨˜éŒ„å¤±æ•—:', e);
                return [];
            }
        }

        // ä¿å­˜æ­·å²è¨˜éŒ„
        function saveHistoryRecord(formData, resultData) {
            try {
                const records = getHistoryRecords();
                const newRecord = {
                    id: Date.now().toString(),
                    timestamp: new Date().toISOString(),
                    input: {
                        year: formData.year,
                        month: formData.month,
                        day: formData.day,
                        time: formData.time,
                        county: document.getElementById('county').value,
                        district: document.getElementById('district').value,
                        longitude: formData.longitude,
                        latitude: formData.latitude,
                        timezone: formData.timezone
                    },
                    result: {
                        input_date: resultData.input_date,
                        personality_list: resultData.personality_list,
                        design_list: resultData.design_list
                    }
                };
                
                // æ·»åŠ åˆ°é–‹é ­ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
                records.unshift(newRecord);
                
                // æœ€å¤šä¿å­˜ 50 ç­†è¨˜éŒ„
                if (records.length > 50) {
                    records.splice(50);
                }
                
                localStorage.setItem('humanDesignHistory', JSON.stringify(records));
                console.log('æ­·å²è¨˜éŒ„å·²ä¿å­˜');
                return newRecord.id;
            } catch (e) {
                console.error('ä¿å­˜æ­·å²è¨˜éŒ„å¤±æ•—:', e);
                return null;
            }
        }

        // åˆªé™¤æ­·å²è¨˜éŒ„
        function deleteHistoryRecord(recordId) {
            try {
                const records = getHistoryRecords();
                const filtered = records.filter(r => r.id !== recordId);
                localStorage.setItem('humanDesignHistory', JSON.stringify(filtered));
                renderHistoryList();
                showMessage('è¨˜éŒ„å·²åˆªé™¤', 'success');
            } catch (e) {
                console.error('åˆªé™¤è¨˜éŒ„å¤±æ•—:', e);
                showMessage('åˆªé™¤å¤±æ•—', 'error');
            }
        }

        // æ¸…ç©ºæ‰€æœ‰æ­·å²è¨˜éŒ„
        function clearAllHistory() {
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰æ­·å²è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                try {
                    localStorage.removeItem('humanDesignHistory');
                    renderHistoryList();
                    showMessage('æ‰€æœ‰è¨˜éŒ„å·²æ¸…ç©º', 'success');
                } catch (e) {
                    console.error('æ¸…ç©ºè¨˜éŒ„å¤±æ•—:', e);
                    showMessage('æ¸…ç©ºå¤±æ•—', 'error');
                }
            }
        }

        // è¼‰å…¥æ­·å²è¨˜éŒ„åˆ°è¡¨å–®
        function loadHistoryRecord(recordId) {
            const records = getHistoryRecords();
            const record = records.find(r => r.id === recordId);
            
            if (!record) {
                showMessage('æ‰¾ä¸åˆ°è¨˜éŒ„', 'error');
                return;
            }
            
            document.getElementById('year').value = record.input.year;
            document.getElementById('month').value = record.input.month;
            document.getElementById('day').value = record.input.day;
            document.getElementById('time').value = record.input.time;
            document.getElementById('timezone').value = record.input.timezone;
            document.getElementById('longitude').value = record.input.longitude;
            document.getElementById('latitude').value = record.input.latitude;
            
            // è¨­ç½®ç¸£å¸‚å’Œå€åŸŸ
            const countySelect = document.getElementById('county');
            const districtSelect = document.getElementById('district');
            countySelect.value = record.input.county;
            
            // è§¸ç™¼ç¸£å¸‚è®Šæ›´äº‹ä»¶ä»¥æ›´æ–°å€åŸŸé¸å–®
            if (countySelect.value) {
                const event = new Event('change');
                countySelect.dispatchEvent(event);
                
                // ç­‰å¾…å€åŸŸé¸å–®æ›´æ–°å¾Œè¨­ç½®å€åŸŸ
                setTimeout(() => {
                    districtSelect.value = record.input.district;
                }, 100);
            }
            
            // é—œé–‰æ­·å²è¨˜éŒ„é¢æ¿
            document.getElementById('history-container').classList.add('hidden');
            
            showMessage('è¨˜éŒ„å·²è¼‰å…¥ï¼Œè«‹é»æ“Šã€Œè¨ˆç®—äººé¡åœ–ã€', 'success');
        }

        // æ¸²æŸ“æ­·å²è¨˜éŒ„åˆ—è¡¨
        function renderHistoryList() {
            const historyList = document.getElementById('history-list');
            const records = getHistoryRecords();
            
            if (records.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">å°šç„¡æ­·å²è¨˜éŒ„</div>';
                return;
            }
            
            let html = '<div style="display: flex; flex-direction: column; gap: 12px;">';
            
            records.forEach(record => {
                const date = new Date(record.timestamp);
                const dateStr = date.toLocaleString('zh-TW', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                html += `
                    <div class="info-box" style="padding: 15px; margin: 0;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div>
                                <strong style="color: #667eea; font-size: 1.1em;">
                                    ${record.input.year}-${String(record.input.month).padStart(2, '0')}-${String(record.input.day).padStart(2, '0')} ${record.input.time}
                                </strong>
                                <div style="color: #666; font-size: 0.9em; margin-top: 4px;">
                                    ${record.input.county} ${record.input.district}
                                </div>
                                <div style="color: #999; font-size: 0.85em; margin-top: 2px;">
                                    ${dateStr}
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-secondary" onclick="loadHistoryRecord('${record.id}')" style="padding: 6px 12px; font-size: 0.9em;">
                                    è¼‰å…¥
                                </button>
                                <button class="btn btn-secondary" onclick="deleteHistoryRecord('${record.id}')" style="padding: 6px 12px; font-size: 0.9em; background: #dc3545; color: white;">
                                    åˆªé™¤
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            historyList.innerHTML = html;
        }

        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(message, type = 'error') {
            const messageArea = document.getElementById('message-area');
            const className = type === 'error' ? 'error-message' : 'success-message';
            messageArea.innerHTML = `<div class="${className}">${message}</div>`;
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }

        // è¡¨å–®æäº¤è™•ç†
        document.getElementById('birth-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const calculateBtn = document.getElementById('calculate-btn');
            const resultsContainer = document.getElementById('results-container');
            const messageArea = document.getElementById('message-area');
            
            // é©—è­‰æ˜¯å¦é¸æ“‡äº†ç¸£å¸‚å’Œå€åŸŸ
            const county = document.getElementById('county').value;
            const district = document.getElementById('district').value;
            if (!county || !district) {
                showMessage('è«‹é¸æ“‡ç¸£å¸‚å’Œå€åŸŸ', 'error');
                return;
            }
            
            // æ”¶é›†è¡¨å–®æ•¸æ“š
            const longitudeInput = document.getElementById('longitude');
            const latitudeInput = document.getElementById('latitude');
            const formData = {
                year: parseInt(document.getElementById('year').value),
                month: parseInt(document.getElementById('month').value),
                day: parseInt(document.getElementById('day').value),
                time: document.getElementById('time').value,
                timezone: document.getElementById('timezone').value.trim(),
                longitude: parseFloat(longitudeInput.value),
                latitude: parseFloat(latitudeInput.value)
            };

            // é©—è­‰æ•¸æ“š
            if (!formData.time || !formData.time.match(/^\d{2}:\d{2}$/)) {
                showMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ™‚é–“æ ¼å¼ (HH:MM)', 'error');
                return;
            }

            // ç¢ºä¿ç¶“ç·¯åº¦å·²æ ¹æ“šé¸æ“‡çš„ç¸£å¸‚å€åŸŸæ›´æ–°
            if (county && district) {
                // å¼·åˆ¶æ›´æ–°ä¸€æ¬¡ï¼Œç¢ºä¿ä½¿ç”¨æœ€æ–°çš„é¸æ“‡
                updateCoordinates(county, district);
                // é‡æ–°è®€å–æ›´æ–°å¾Œçš„å€¼
                formData.longitude = parseFloat(longitudeInput.value);
                formData.latitude = parseFloat(latitudeInput.value);
            }
            
            // é©—è­‰ç¶“ç·¯åº¦æ˜¯å¦æœ‰æ•ˆ
            if (isNaN(formData.longitude) || isNaN(formData.latitude)) {
                showMessage('ç¶“ç·¯åº¦æ•¸æ“šç„¡æ•ˆï¼Œè«‹é‡æ–°é¸æ“‡ç¸£å¸‚å’Œå€åŸŸ', 'error');
                return;
            }

            console.log('æäº¤è¡¨å–®æ•¸æ“š:', formData);

            // ç¦ç”¨æŒ‰éˆ•ï¼Œé¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            calculateBtn.disabled = true;
            calculateBtn.textContent = 'è¨ˆç®—ä¸­...';
            messageArea.innerHTML = '';

            try {
                // ç™¼é€ POST è«‹æ±‚åˆ°å¾Œç«¯ï¼ˆFlask APIï¼‰
                const response = await fetch('/calculate_hd', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                // æª¢æŸ¥éŸ¿æ‡‰ç‹€æ…‹
                if (!response.ok) {
                    // å˜—è©¦è§£æéŒ¯èª¤éŸ¿æ‡‰
                    let errorText = '';
                    try {
                        const errorResult = await response.json();
                        errorText = errorResult.error || `HTTP ${response.status}`;
                    } catch (e) {
                        errorText = await response.text() || `HTTP ${response.status}`;
                    }
                    showMessage(`ä¼ºæœå™¨éŒ¯èª¤: ${errorText}`, 'error');
                    return;
                }

                const result = await response.json();

                if (result.status === 'success' && result.data) {
                    // ä¿å­˜æ­·å²è¨˜éŒ„
                    saveHistoryRecord(formData, result.data);
                    
                    // é¡¯ç¤ºçµæœå€åŸŸ
                    resultsContainer.classList.remove('hidden');
                    
                    // æ¸²æŸ“è¦–è¦ºåŒ–
                    renderHumanDesign(result.data);
                    
                    showMessage('è¨ˆç®—å®Œæˆï¼è¨˜éŒ„å·²ä¿å­˜', 'success');
                } else {
                    showMessage(result.error || 'è¨ˆç®—å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¼¸å…¥æ•¸æ“š', 'error');
                }
            } catch (error) {
                console.error('éŒ¯èª¤:', error);
                let errorMessage = 'ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ã€‚è«‹ç¢ºä¿å¾Œç«¯æœå‹™æ­£åœ¨é‹è¡Œã€‚';
                if (error.message) {
                    errorMessage += ` (${error.message})`;
                }
                showMessage(errorMessage, 'error');
            } finally {
                // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
                calculateBtn.disabled = false;
                calculateBtn.textContent = 'è¨ˆç®—äººé¡åœ–';
            }
        });

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        function initializePage() {
            // è¨­ç½®åœ°å€é¸æ“‡äº‹ä»¶ç›£è½å™¨
            const regionSelect = document.getElementById('region');
            if (regionSelect) {
                regionSelect.addEventListener('change', function() {
                    const region = this.value;
                    // æ¸…ç©ºç¸£å¸‚å’Œå€åŸŸé¸å–®
                    const countySelect = document.getElementById('county');
                    const districtSelect = document.getElementById('district');
                    if (countySelect) {
                        countySelect.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡åœ°å€</option>';
                    }
                    if (districtSelect) {
                        districtSelect.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡ç¸£å¸‚/çœä»½</option>';
                    }
                    // é‡ç½®ç¶“ç·¯åº¦
                    const longitudeInput = document.getElementById('longitude');
                    const latitudeInput = document.getElementById('latitude');
                    if (longitudeInput) longitudeInput.value = '121.5';
                    if (latitudeInput) latitudeInput.value = '25.0';
                    // é‡æ–°åˆå§‹åŒ–ç¸£å¸‚é¸å–®
                    if (region) {
                        initializeCountySelect();
                    }
                });
            }
            
            // åˆå§‹åŒ–ç¸£å¸‚é¸å–®ï¼ˆå¦‚æœå·²é¸æ“‡åœ°å€ï¼‰
            initializeCountySelect();
            
            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            const countySelect = document.getElementById('county');
            const districtSelect = document.getElementById('district');
            
            if (countySelect && districtSelect) {
                // ç¸£å¸‚é¸æ“‡è®Šæ›´äº‹ä»¶
                countySelect.addEventListener('change', function() {
                    const county = this.value;
                    updateDistrictSelect(county);
                    // æ¸…ç©ºç¶“ç·¯åº¦ï¼ˆç­‰å¾…é¸æ“‡å€åŸŸå¾Œå†æ›´æ–°ï¼‰
                    if (!county) {
                        const longitudeInput = document.getElementById('longitude');
                        const latitudeInput = document.getElementById('latitude');
                        if (longitudeInput) longitudeInput.value = '121.5';
                        if (latitudeInput) latitudeInput.value = '25.0';
                    }
                });

                // å€åŸŸé¸æ“‡è®Šæ›´äº‹ä»¶
                districtSelect.addEventListener('change', function() {
                    const county = countySelect.value;
                    const district = this.value;
                    console.log('é¸æ“‡äº†å€åŸŸ:', { county, district });
                    if (county && district) {
                        updateCoordinates(county, district);
                    }
                });
            }

        // é‡ç½®æŒ‰éˆ•
            const resetBtn = document.getElementById('reset-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    document.getElementById('birth-form').reset();
                    document.getElementById('message-area').innerHTML = '';
                    document.getElementById('results-container').classList.add('hidden');
                    // æ¸…ç©ºç¸£å¸‚å’Œå€åŸŸé¸å–®
                    const countySelect = document.getElementById('county');
                    const districtSelect = document.getElementById('district');
                    if (countySelect) {
                        countySelect.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡åœ°å€</option>';
                    }
                    if (districtSelect) {
                        districtSelect.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡ç¸£å¸‚/çœä»½</option>';
                    }
                    // é‡ç½®ç¶“ç·¯åº¦
                    const longitudeInput = document.getElementById('longitude');
                    const latitudeInput = document.getElementById('latitude');
                    if (longitudeInput) longitudeInput.value = '121.5';
                    if (latitudeInput) latitudeInput.value = '25.0';
                });
            }

            // æ­·å²è¨˜éŒ„æŒ‰éˆ•
            const historyBtn = document.getElementById('history-btn');
            if (historyBtn) {
                historyBtn.addEventListener('click', function() {
                    const historyContainer = document.getElementById('history-container');
                    if (historyContainer.classList.contains('hidden')) {
                        historyContainer.classList.remove('hidden');
                        renderHistoryList();
                    } else {
                        historyContainer.classList.add('hidden');
                    }
                });
            }

            // é—œé–‰æ­·å²è¨˜éŒ„æŒ‰éˆ•
            const closeHistoryBtn = document.getElementById('close-history-btn');
            if (closeHistoryBtn) {
                closeHistoryBtn.addEventListener('click', function() {
                    document.getElementById('history-container').classList.add('hidden');
                });
            }

            // æ¸…ç©ºæ­·å²è¨˜éŒ„æŒ‰éˆ•
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            if (clearHistoryBtn) {
                clearHistoryBtn.addEventListener('click', function() {
                    clearAllHistory();
                });
            }
        }

        // ç¢ºä¿ DOM è¼‰å…¥å¾ŒåŸ·è¡Œåˆå§‹åŒ–
        (function() {
            function init() {
                try {
                    console.log('é–‹å§‹åˆå§‹åŒ–é é¢...');
                    console.log('DOM readyState:', document.readyState);
                    console.log('taiwanLocations æ˜¯å¦å­˜åœ¨:', typeof taiwanLocations !== 'undefined');
                    
                    if (typeof taiwanLocations === 'undefined') {
                        console.error('taiwanLocations æœªå®šç¾©ï¼');
                        return;
                    }
                    
                    if (document.readyState === 'loading') {
                        console.log('ç­‰å¾… DOM è¼‰å…¥...');
                        document.addEventListener('DOMContentLoaded', initializePage);
                    } else {
                        console.log('DOM å·²æº–å‚™å¥½ï¼Œç«‹å³åŸ·è¡Œåˆå§‹åŒ–');
                        initializePage();
                    }
                } catch (error) {
                    console.error('åˆå§‹åŒ–éŒ¯èª¤:', error);
                }
            }
            
            // åŸ·è¡Œåˆå§‹åŒ–
            init();
        })();
        
        // åŠ è¼‰åŸºå› å¤©å‘½æ•¸æ“šä¸¦åˆå§‹åŒ–é¢æ¿ï¼ˆåœ¨ IIFE å¤–éƒ¨ï¼‰
        loadGeneKeysData().then(() => {
            initGeneKeyDetailPanel();
        });
    </script>
</body>
</html>

